# æ–°æ¦‚å¿µå•ç‹¬åˆ—å‡ºåŠŸèƒ½è¯´æ˜

## åŠŸèƒ½éœ€æ±‚

å½“åŒèŠ±é¡ºæ–°å¢æ¦‚å¿µæ¿å—æ—¶ï¼Œç³»ç»Ÿéœ€è¦ï¼š
1. **è‡ªåŠ¨è¯†åˆ«**æ–°æ¦‚å¿µï¼ˆå†å²æ•°æ®ä¸è¶³5ä¸ªäº¤æ˜“æ—¥ï¼‰
2. **å•ç‹¬æ ‡è®°**æ–°æ¦‚å¿µï¼Œæ–¹ä¾¿å‰ç«¯å•ç‹¬å±•ç¤º
3. **ä¸é—æ¼**ä»»ä½•æ–°å‡ºç°çš„çƒ­é—¨æ¦‚å¿µ

## å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®åº“å±‚ï¼šæ·»åŠ  `is_new_concept` å­—æ®µ

#### æ–°å¢å­—æ®µ

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| is_new_concept | BOOLEAN | NOT NULL DEFAULT false | æ˜¯å¦ä¸ºæ–°æ¦‚å¿µï¼ˆå†å²æ•°æ®ä¸è¶³5ä¸ªäº¤æ˜“æ—¥ï¼‰ |

#### æ–°å¢ç´¢å¼•

```sql
CREATE INDEX idx_hot_concepts_new_concepts
ON hot_concepts(trade_date, is_new_concept)
WHERE is_new_concept = true;
```

**ä¼˜åŒ–è¯´æ˜ï¼š**
- ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•ï¼ˆWHERE is_new_concept = trueï¼‰
- åªç´¢å¼•æ–°æ¦‚å¿µï¼Œå‡å°‘ç´¢å¼•å¤§å°
- åŠ é€Ÿå‰ç«¯æŸ¥è¯¢"ä»Šå¤©çš„æ–°æ¦‚å¿µ"

### 2. é‡‡é›†ä»£ç å±‚ï¼šè‡ªåŠ¨æ ‡è®°æ–°æ¦‚å¿µ

#### æ ¸å¿ƒé€»è¾‘

```python
# åˆ¤æ–­æ˜¯å¦ä¸ºæ–°æ¦‚å¿µ
is_new_concept = len(last_5_days) < 5  # å†å²æ•°æ®ä¸è¶³5å¤©

# æ·»åŠ åˆ°æ•°æ®ç»“æ„
concept_data = {
    "trade_date": actual_trade_date,
    "concept_name": concept_name,
    "change_pct": round(total_change_pct, 2),
    "concept_strength": round(concept_strength, 4),
    "rank": 0,
    "is_new_concept": is_new_concept,  # âœ… æ ‡è®°æ–°æ¦‚å¿µ
}
```

#### æ—¥å¿—è¾“å‡º

é‡‡é›†æ—¶ä¼šæ˜¾ç¤ºï¼š

```
10:23:15 | INFO | å¼€å§‹å¤„ç† 374 ä¸ªæ¦‚å¿µæ¿å—...
10:23:18 | INFO | ğŸ†• å‘ç°æ–°æ¦‚å¿µ: AI+æœºå™¨äºº (ä»…3ä¸ªäº¤æ˜“æ—¥æ•°æ®ï¼Œ3æ—¥æ¶¨å¹…: 28.50%)
10:23:22 | INFO | ğŸ†• å‘ç°æ–°æ¦‚å¿µ: é‡å­é€šä¿¡2.0 (ä»…2ä¸ªäº¤æ˜“æ—¥æ•°æ®ï¼Œ2æ—¥æ¶¨å¹…: 15.20%)
10:24:01 | INFO | æˆåŠŸé‡‡é›† 50 ä¸ªçƒ­é—¨æ¦‚å¿µæ¿å—ï¼ˆäº¤æ˜“æ—¥: 2025-12-08ï¼ŒæŒ‰ç´¯è®¡æ¶¨å¹…æ’åºï¼‰
10:24:01 | INFO | ğŸ†• å…¶ä¸­åŒ…å« 2 ä¸ªæ–°æ¦‚å¿µï¼ˆå†å²æ•°æ®ä¸è¶³5ä¸ªäº¤æ˜“æ—¥ï¼‰
10:24:01 | INFO |   [1] äººå·¥æ™ºèƒ½: æ¶¨å¹… 10.23%
10:24:01 | INFO |   [2] AI+æœºå™¨äºº: æ¶¨å¹… 28.50% ğŸ†•
10:24:01 | INFO |   [3] èŠ¯ç‰‡: æ¶¨å¹… 8.76%
```

### 3. å‰ç«¯å±•ç¤ºå±‚ï¼šä¸¤ç§æŸ¥è¯¢æ–¹å¼

#### æŸ¥è¯¢æ‰€æœ‰çƒ­é—¨æ¦‚å¿µï¼ˆåŒ…æ‹¬æ–°æ¦‚å¿µï¼‰

```sql
SELECT *
FROM hot_concepts
WHERE trade_date = '2025-12-08'
ORDER BY rank;
```

è¿”å›ç¤ºä¾‹ï¼š

```json
[
  {
    "rank": 1,
    "concept_name": "äººå·¥æ™ºèƒ½",
    "change_pct": 10.23,
    "is_new_concept": false
  },
  {
    "rank": 2,
    "concept_name": "AI+æœºå™¨äºº",
    "change_pct": 28.50,
    "is_new_concept": true  // âœ… æ–°æ¦‚å¿µæ ‡è®°
  },
  {
    "rank": 3,
    "concept_name": "èŠ¯ç‰‡",
    "change_pct": 8.76,
    "is_new_concept": false
  }
]
```

#### æŸ¥è¯¢ä»…æ–°æ¦‚å¿µï¼ˆå•ç‹¬åˆ—å‡ºï¼‰

```sql
SELECT *
FROM hot_concepts
WHERE trade_date = '2025-12-08'
  AND is_new_concept = true
ORDER BY rank;
```

è¿”å›ç¤ºä¾‹ï¼š

```json
[
  {
    "rank": 2,
    "concept_name": "AI+æœºå™¨äºº",
    "change_pct": 28.50,
    "is_new_concept": true
  },
  {
    "rank": 15,
    "concept_name": "é‡å­é€šä¿¡2.0",
    "change_pct": 15.20,
    "is_new_concept": true
  }
]
```

### 4. å‰ç«¯UIè®¾è®¡å»ºè®®

#### æ–¹æ¡ˆAï¼šåœ¨åˆ—è¡¨ä¸­æ ‡è®°æ–°æ¦‚å¿µ

```
çƒ­é—¨æ¦‚å¿µæ¿å—ï¼ˆ2025-12-08ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. äººå·¥æ™ºèƒ½           +10.23%
2. AI+æœºå™¨äºº ğŸ†•       +28.50%   â† æ–°æ¦‚å¿µæ ‡è®°
3. èŠ¯ç‰‡               +8.76%
4. æ–°èƒ½æº             +7.45%
5. é‡å­é€šä¿¡2.0 ğŸ†•     +15.20%   â† æ–°æ¦‚å¿µæ ‡è®°
```

#### æ–¹æ¡ˆBï¼šå•ç‹¬åŒºåŸŸå±•ç¤ºæ–°æ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ†• æ–°æ¦‚å¿µæ¿å—ï¼ˆ2ä¸ªï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. AI+æœºå™¨äºº       +28.50%      â”‚
â”‚ 2. é‡å­é€šä¿¡2.0     +15.20%      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ çƒ­é—¨æ¦‚å¿µæ¿å—ï¼ˆ50ä¸ªï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. äººå·¥æ™ºèƒ½        +10.23%      â”‚
â”‚ 2. AI+æœºå™¨äºº ğŸ†•    +28.50%      â”‚
â”‚ 3. èŠ¯ç‰‡            +8.76%       â”‚
â”‚ ...                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ–¹æ¡ˆCï¼šTabåˆ‡æ¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨éƒ¨(50)â”‚ ğŸ†•æ–°æ¦‚å¿µ(2)â”‚ æˆç†Ÿæ¦‚å¿µ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ–°æ¦‚å¿µ Tab å†…å®¹ã€‘
1. AI+æœºå™¨äºº       +28.50%  (2æ—¥æ¶¨å¹…)
2. é‡å­é€šä¿¡2.0     +15.20%  (3æ—¥æ¶¨å¹…)

ğŸ’¡ æç¤ºï¼šæ–°æ¦‚å¿µé€šå¸¸åœ¨åˆæœŸæœ€æ´»è·ƒï¼Œå€¼å¾—é‡ç‚¹å…³æ³¨
```

## å®Œæ•´çš„æ•°æ®æµ

### æ•°æ®é‡‡é›†æµç¨‹

```
åŒèŠ±é¡ºAPI
   â”‚
   â–¼
è·å–æ‰€æœ‰æ¦‚å¿µåˆ—è¡¨ï¼ˆ374ä¸ªï¼‰
   â”‚
   â–¼
éå†æ¯ä¸ªæ¦‚å¿µ
   â”‚
   â–¼
è·å–å†å²äº¤æ˜“æ•°æ®ï¼ˆ15å¤©ï¼‰
   â”‚
   â–¼
åˆ¤æ–­ï¼šäº¤æ˜“æ—¥æ•°é‡ >= 5ï¼Ÿ
   â”‚
   â”œâ”€ æ˜¯ â†’ is_new_concept = false  (æˆç†Ÿæ¦‚å¿µ)
   â”‚         ä½¿ç”¨æœ€å5ä¸ªäº¤æ˜“æ—¥
   â”‚
   â””â”€ å¦ â†’ is_new_concept = true   (æ–°æ¦‚å¿µ ğŸ†•)
             ä½¿ç”¨æ‰€æœ‰å¯ç”¨äº¤æ˜“æ—¥ï¼ˆ2-4å¤©ï¼‰
   â”‚
   â–¼
è®¡ç®—æ¶¨å¹… + æ’å
   â”‚
   â–¼
ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆåŒ…å« is_new_concept å­—æ®µï¼‰
   â”‚
   â–¼
å‰ç«¯é€šè¿‡ is_new_concept å­—æ®µ
å•ç‹¬æŸ¥è¯¢å’Œå±•ç¤ºæ–°æ¦‚å¿µ
```

### å‰ç«¯æŸ¥è¯¢ç¤ºä¾‹ï¼ˆFastAPIï¼‰

```python
from fastapi import APIRouter, Query
from typing import Optional

router = APIRouter()

@router.get("/hot-concepts")
async def get_hot_concepts(
    trade_date: str,
    new_only: Optional[bool] = Query(False, description="ä»…è¿”å›æ–°æ¦‚å¿µ")
):
    """
    è·å–çƒ­é—¨æ¦‚å¿µæ¿å—

    å‚æ•°:
    - trade_date: äº¤æ˜“æ—¥æœŸ YYYY-MM-DD
    - new_only: æ˜¯å¦ä»…è¿”å›æ–°æ¦‚å¿µï¼ˆé»˜è®¤falseï¼‰
    """
    query = supabase.table("hot_concepts").select("*").eq("trade_date", trade_date)

    if new_only:
        query = query.eq("is_new_concept", True)  # âœ… ä»…æ–°æ¦‚å¿µ

    result = query.order("rank").execute()
    return result.data

# ä½¿ç”¨ç¤ºä¾‹ï¼š
# GET /hot-concepts?trade_date=2025-12-08                # å…¨éƒ¨50ä¸ª
# GET /hot-concepts?trade_date=2025-12-08&new_only=true  # ä»…æ–°æ¦‚å¿µ
```

## æ‰§è¡Œæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

```bash
docs/rebuild_hot_concepts_table.sql
```

**é‡è¦æç¤ºï¼š** æ­¤æ“ä½œä¼šåˆ é™¤æ—§æ•°æ®ï¼æ‰§è¡Œå‰è¯·ç¡®è®¤ã€‚

æˆ–è€…ï¼Œå¦‚æœè¦ä¿ç•™æ—§æ•°æ®ï¼Œæ‰§è¡Œï¼š

```bash
docs/add_is_new_concept_field.sql
```

### ç¬¬äºŒæ­¥ï¼šéªŒè¯è¡¨ç»“æ„

æ‰§è¡Œåæ£€æŸ¥å­—æ®µï¼š

```sql
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'hot_concepts'
ORDER BY ordinal_position;
```

åº”è¯¥çœ‹åˆ°ï¼š

```
column_name      | data_type | is_nullable | column_default
-----------------+-----------+-------------+---------------
id               | bigint    | NO          | nextval(...)
trade_date       | date      | NO          | NULL
concept_name     | text      | NO          | NULL
change_pct       | numeric   | NO          | NULL
concept_strength | numeric   | NO          | NULL
rank             | integer   | NO          | NULL
is_new_concept   | boolean   | NO          | false  âœ…
created_at       | timestamp | YES         | now()
updated_at       | timestamp | YES         | now()
```

### ç¬¬ä¸‰æ­¥ï¼šé‡æ–°é‡‡é›†æ•°æ®

```bash
cd backend
source venv/bin/activate
python3 ../scripts/collect-full-hot-concepts.py
```

### ç¬¬å››æ­¥ï¼šéªŒè¯æ–°æ¦‚å¿µæ ‡è®°

æŸ¥è¯¢æ–°æ¦‚å¿µï¼š

```sql
SELECT concept_name, change_pct, is_new_concept, rank
FROM hot_concepts
WHERE trade_date = (SELECT MAX(trade_date) FROM hot_concepts)
  AND is_new_concept = true
ORDER BY rank;
```

å¦‚æœæœ‰æ–°æ¦‚å¿µï¼Œä¼šè¿”å›ç»“æœï¼š

```
concept_name    | change_pct | is_new_concept | rank
----------------+------------+----------------+------
AI+æœºå™¨äºº       |      28.50 | true           |    2
é‡å­é€šä¿¡2.0     |      15.20 | true           |   15
```

## ä¼˜åŠ¿

### å¯¹ç”¨æˆ·çš„å¥½å¤„

1. **ä¸ä¼šé—æ¼æ–°çƒ­ç‚¹**
   - æ–°æ¦‚å¿µä»ç¬¬2ä¸ªäº¤æ˜“æ—¥å°±èƒ½è¢«è¯†åˆ«
   - åŠæ—¶æ•æ‰å¸‚åœºæ–°è¶‹åŠ¿

2. **å•ç‹¬å±•ç¤ºæ–°æ¦‚å¿µ**
   - é€šè¿‡ `is_new_concept = true` ç­›é€‰
   - å‰ç«¯å¯ä»¥åš"æ–°æ¦‚å¿µä¸“åŒº"

3. **è‡ªåŠ¨åŒ–è¯†åˆ«**
   - æ— éœ€äººå·¥æ ‡è®°
   - ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å¹¶ä¿å­˜

### å¯¹å¼€å‘çš„å¥½å¤„

1. **æ•°æ®åº“å±‚é¢æ”¯æŒ**
   - ä¸“ç”¨å­—æ®µå­˜å‚¨
   - éƒ¨åˆ†ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢

2. **APIçµæ´»æ€§**
   - æ”¯æŒæŸ¥è¯¢å…¨éƒ¨æ¦‚å¿µ
   - æ”¯æŒä»…æŸ¥è¯¢æ–°æ¦‚å¿µ
   - æ”¯æŒæ··åˆå±•ç¤º

3. **å¯æ‰©å±•æ€§**
   - æœªæ¥å¯ä»¥æ·»åŠ "æ–°æ¦‚å¿µæŒç»­å¤©æ•°"
   - å¯ä»¥è¿½è¸ªæ¦‚å¿µä»"æ–°"åˆ°"æˆç†Ÿ"çš„è¿‡ç¨‹

## ç›¸å…³æ–‡ä»¶

- æ•°æ®åº“é‡å»ºè„šæœ¬ï¼š`docs/rebuild_hot_concepts_table.sql`
- æ·»åŠ å­—æ®µè„šæœ¬ï¼ˆä¿ç•™æ•°æ®ï¼‰ï¼š`docs/add_is_new_concept_field.sql`
- é‡‡é›†ä»£ç ï¼š`backend/app/services/collectors/hot_concepts_collector.py`
- å®Œæ•´é‡‡é›†è„šæœ¬ï¼š`scripts/collect-full-hot-concepts.py`
- æµ‹è¯•è„šæœ¬ï¼š`scripts/test-new-concept-detection.py`

## æ€»ç»“

é€šè¿‡æ·»åŠ  `is_new_concept` å­—æ®µï¼Œç³»ç»Ÿç°åœ¨èƒ½å¤Ÿï¼š

âœ… **è‡ªåŠ¨è¯†åˆ«**æ–°æ¦‚å¿µï¼ˆå†å²æ•°æ®<5å¤©ï¼‰
âœ… **æ•°æ®åº“æ ‡è®°**å­˜å‚¨ï¼ˆis_new_conceptå­—æ®µï¼‰
âœ… **æ—¥å¿—æ˜ç¡®æç¤º**ï¼ˆğŸ†• æ ‡è®°ï¼‰
âœ… **å‰ç«¯çµæ´»æŸ¥è¯¢**ï¼ˆå¯å•ç‹¬åˆ—å‡ºæ–°æ¦‚å¿µï¼‰
âœ… **ä¸é—æ¼çƒ­ç‚¹**ï¼ˆä»ç¬¬2ä¸ªäº¤æ˜“æ—¥å¼€å§‹è¿½è¸ªï¼‰

è¿™æ ·å°±èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼š**å½“æœ‰æ–°çš„æ¿å—å‡ºç°æ—¶ï¼Œèƒ½è¯†åˆ«å‡ºæ¥å¹¶åœ¨çƒ­ç‚¹æ¦‚å¿µæ¿å—ä¸­å•ç‹¬åˆ—å‡ºæ¥**ã€‚
