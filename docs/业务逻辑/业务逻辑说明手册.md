# 短线复盘工具 - 业务逻辑说明手册

**文档版本**: v1.0
**创建日期**: 2025-12-10
**最后更新**: 2025-12-10

---

## 目录

1. [市场情绪评分系统](#1-市场情绪评分系统)
2. [涨跌停判断逻辑](#2-涨跌停判断逻辑)
3. [炸板率计算逻辑](#3-炸板率计算逻辑)
4. [连板分布统计](#4-连板分布统计)
5. [主力资金流向](#5-主力资金流向)

---

## 1. 市场情绪评分系统

### 1.1 设计目标

通过多维度指标综合评估当日市场情绪，帮助短线交易者判断市场环境是否适合操作。

### 1.2 评分指标

系统采用5个核心指标进行综合评分：

| 指标 | 权重 | 说明 |
|------|------|------|
| 上涨占比 | 1 | 全市场上涨股票数量占比 |
| 成交额变化 | 1 | 与上一交易日成交额对比变化率 |
| 涨停数变化 | 1 | 与上一交易日涨停数量对比 |
| 跌停数变化 | 1 | 与上一交易日跌停数量对比 |
| 炸板率 | 1 | 当日炸板数/(涨停数+炸板数) |

### 1.3 单项评分规则

#### 1.3.1 上涨占比

```
上涨占比 = 上涨股票数 / (上涨股票数 + 下跌股票数) × 100%
```

| 条件 | 得分 | 说明 |
|------|------|------|
| > 50% | +1 | 多数股票上涨，市场偏强 |
| 30% ~ 50% | 0 | 涨跌参半，市场中性 |
| < 30% | -1 | 多数股票下跌，市场偏弱 |

#### 1.3.2 成交额变化

```
成交额变化率 = (今日成交额 - 昨日成交额) / 昨日成交额 × 100%
```

| 条件 | 得分 | 说明 |
|------|------|------|
| > +10% | +1 | 明显放量，资金活跃 |
| -10% ~ +10% | 0 | 成交平稳 |
| < -10% | -1 | 明显缩量，资金观望 |

#### 1.3.3 涨停数变化

```
涨停变化比 = 今日涨停数 / 昨日涨停数
```

| 条件 | 得分 | 说明 |
|------|------|------|
| 今日 > 昨日 | +1 | 涨停数增加，赚钱效应提升 |
| 今日 × 1.3 ≥ 昨日 > 今日 | 0 | 涨停数小幅减少，正常波动 |
| 今日 < 昨日 × 0.7 | -1 | 涨停数大幅减少（降幅>30%），赚钱效应减弱 |

#### 1.3.4 跌停数变化

| 条件 | 得分 | 说明 |
|------|------|------|
| 今日 < 昨日 | +1 | 跌停数减少，恐慌缓解 |
| 今日 ≤ 昨日 × 1.5 | 0 | 跌停数小幅增加，正常波动 |
| 今日 > 昨日 × 1.5 | -1 | 跌停数大幅增加（增幅>50%），恐慌加剧 |

**特殊情况处理**：
- 昨日跌停数为0时：今日跌停数 ≤ 3 得0分，> 3 得-1分

#### 1.3.5 炸板率

```
炸板率 = 炸板数 / (涨停数 + 炸板数) × 100%
```

| 条件 | 得分 | 说明 |
|------|------|------|
| < 20% | +1 | 封板强度高，资金承接力强 |
| 20% ~ 30% | 0 | 封板强度正常 |
| > 30% | -1 | 封板强度弱，追高风险大 |

### 1.4 综合评分与情绪等级

**总分范围**: -5 ~ +5

| 总分 | 情绪等级 | 颜色标识 | 操作建议 |
|------|---------|---------|---------|
| +4 ~ +5 | 极度亢奋 | 🔴 深红 | 注意高位风险 |
| +2 ~ +3 | 情绪偏热 | 🟠 橙色 | 可积极参与 |
| +1 | 情绪偏暖 | 🟡 黄色 | 可适度参与 |
| 0 | 情绪中性 | ⚪ 灰色 | 观望为主 |
| -1 | 情绪偏冷 | 🟡 黄色 | 谨慎参与 |
| -2 ~ -3 | 情绪偏弱 | 🔵 蓝色 | 控制仓位 |
| -4 ~ -5 | 极度冰点 | 🟢 绿色 | 空仓观望 |

### 1.5 计算示例

以 2025-12-09 数据为例：

| 指标 | 数据 | 计算过程 | 得分 |
|------|------|---------|------|
| 上涨占比 | 1280涨 / 3801跌 | 25.19% < 30% | -1 |
| 成交额变化 | 19058亿 vs 昨日 | -6.5%，在±10%内 | 0 |
| 涨停数变化 | 53 vs 74 | 53 < 74×0.7=51.8? 否，53 > 51.8 | 0 |
| 跌停数变化 | 7 vs 2 | 7 > 2×1.5=3 | -1 |
| 炸板率 | 30.3% | > 30% | -1 |
| **总分** | | | **-3** |

**结论**: 情绪偏弱 🔵，建议控制仓位

---

## 2. 涨跌停判断逻辑

### 2.1 涨停判断

```
普通股票涨停价 = 前收盘价 × 1.10（四舍五入到分）
ST股票涨停价 = 前收盘价 × 1.05（四舍五入到分）
```

**涨停条件**: 当前价格 = 涨停价 且 有封单

### 2.2 跌停判断

```
普通股票跌停价 = 前收盘价 × 0.90（四舍五入到分）
ST股票跌停价 = 前收盘价 × 0.95（四舍五入到分）
```

**跌停条件**: 当前价格 = 跌停价 且 有封单

### 2.3 数据来源

使用 AKShare `stock_zt_pool_em` 接口获取涨停池数据，已包含涨停判断。

---

## 3. 炸板率计算逻辑

### 3.1 定义

**炸板**: 股票盘中触及涨停价后，封单被打开，收盘未能封住涨停。

### 3.2 计算公式

```
炸板率 = 炸板数 / (最终涨停数 + 炸板数) × 100%
```

**说明**:
- 分母是"曾经涨停的股票总数"
- 最终涨停数：收盘时封住涨停的股票数量
- 炸板数：盘中涨停但收盘未封住的股票数量

### 3.3 数据来源

- 涨停数：`stock_zt_pool_em` 接口
- 炸板数：`stock_zt_pool_zbgc_em` 接口（炸板股池）

### 3.4 参考阈值

| 炸板率 | 市场含义 |
|--------|---------|
| < 15% | 封板强度极高，市场承接力强 |
| 15% ~ 25% | 封板强度正常 |
| 25% ~ 35% | 封板强度偏弱，追高有风险 |
| > 35% | 封板强度很弱，追涨停风险大 |

---

## 4. 连板分布统计

### 4.1 定义

**连板**: 股票连续多个交易日涨停。

- 首板：当日首次涨停（连续涨停天数=1）
- 2连板：连续2个交易日涨停
- 3连板：连续3个交易日涨停
- ...以此类推

### 4.2 统计维度

```json
{
  "1": 35,   // 首板股票数量
  "2": 10,   // 2连板数量
  "3": 5,    // 3连板数量
  "4": 2,    // 4连板数量
  "5+": 1    // 5板及以上数量
}
```

### 4.3 市场含义

- **首板数量多**: 市场活跃，新题材涌现
- **高度板存在**: 市场有龙头效应，情绪延续性好
- **断层明显**: 如首板多但2板少，说明晋级率低，追高风险大

---

## 5. 主力资金流向

### 5.1 定义

**主力资金** = 超大单 + 大单

- 超大单：单笔成交金额 > 100万
- 大单：单笔成交金额 20万 ~ 100万
- 中单：单笔成交金额 4万 ~ 20万
- 小单：单笔成交金额 < 4万

### 5.2 字段说明

| 字段 | 说明 | 单位 |
|------|------|------|
| main_net_inflow | 主力净流入金额 | 元 |
| main_net_inflow_pct | 主力净流入占比 | % |

### 5.3 计算公式

```
主力净流入 = 主力买入金额 - 主力卖出金额
主力净流入占比 = 主力净流入 / 当日成交额 × 100%
```

### 5.4 参考意义

| 情况 | 含义 |
|------|------|
| 净流入 > 0 | 主力资金买入为主，看好后市 |
| 净流入 < 0 | 主力资金卖出为主，可能出货 |
| 占比 > 10% | 主力介入程度高 |
| 占比 < -10% | 主力出货明显 |

### 5.5 数据来源

AKShare `stock_individual_fund_flow` 接口，按股票代码和日期查询。

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|---------|
| 2025-12-10 | v1.0 | 初始版本，包含市场情绪评分、涨跌停判断、炸板率、连板分布、主力资金流向逻辑说明 |

---

## 附录：相关代码位置

| 逻辑 | 文件路径 |
|------|---------|
| 市场情绪评分 | `frontend/app/page.tsx` |
| 炸板率计算 | `backend/app/services/collectors/limit_stocks_collector.py` |
| 主力资金采集 | `backend/app/services/collectors/limit_stocks_collector.py` |
| 连板分布统计 | `backend/app/services/collectors/limit_stocks_collector.py` |
