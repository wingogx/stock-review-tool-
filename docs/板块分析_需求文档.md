# 板块分析功能需求文档

## 📋 文档信息

- **版本**: v1.0
- **创建日期**: 2025-12-12
- **最后更新**: 2025-12-12
- **负责人**: 短线复盘项目团队

---

## 1. 功能概述

### 1.1 功能定位

板块分析页面是短线复盘系统的核心功能之一，在交易决策链中处于关键位置：

```
大盘分析 → 板块分析 → 个股分析
 (能做吗?)   (往哪里做?)   (做哪个?)
```

**核心价值**: 帮助用户识别当前市场中**最有机会的概念板块**，回答"往哪个方向做交易"的问题。

### 1.2 功能范围

- ✅ **趋势板块**: 识别持续上涨的强势板块
- ✅ **情绪板块**: 识别市场情绪高涨的热门板块
- ✅ **主线板块**: 识别趋势+情绪共振的核心主线
- ✅ **异动板块**: 捕捉盘中突发的机会板块

**重要说明**:
- 本系统的"板块"专指**概念板块**(Concept)，如"人工智能"、"新能源汽车"等
- **不包含**传统行业板块(Industry)，如"银行"、"医药"等

---

## 2. 详细需求

### 2.1 趋势板块

#### 定义
根据5日涨幅排序，识别**持续上涨**的强势概念板块。

#### 数据来源
- 数据表: `hot_concepts`
- 数据范围: 首页"热门概念TOP10"

#### 筛选规则
- 按5日涨幅降序排序
- 取前6名

#### 展示字段

| 字段名 | 数据库字段 | 说明 | 示例 |
|--------|-----------|------|------|
| 板块名称 | `concept_name` | 概念名称 | "人工智能" |
| 当日涨幅 | `day_change_pct` | 当日涨跌幅(%) | +3.52% |
| 5日涨幅 | `change_pct` | 5日累计涨幅(%) | +12.68% |
| 龙头股 | `leader_stock_name` | 板块龙头股票名称 | "科大讯飞" |

#### 排序规则
保持首页排序(按5日涨幅降序)

#### 业务逻辑
```
SELECT * FROM hot_concepts
WHERE trade_date = '当日'
ORDER BY change_pct DESC  -- 5日涨幅降序
LIMIT 6
```

---

### 2.2 情绪板块

#### 定义
识别市场**情绪高涨**、涨停家数众多的热门板块。

#### 数据来源
- 数据表: `hot_concepts`
- 数据范围: 首页"热门概念TOP10"

#### 筛选规则
- 当日涨停数 > 10 (包含创业板20%涨停)
- 从TOP10中筛选

#### 展示字段

| 字段名 | 数据库字段 | 说明 | 示例 |
|--------|-----------|------|------|
| 板块名称 | `concept_name` | 概念名称 | "新能源汽车" |
| 当日涨幅 | `day_change_pct` | 当日涨跌幅(%) | +5.28% |
| 涨停数 | `limit_up_count` | 涨停家数(含创业板) | 15 |
| 龙头股 | `leader_stock_name` | 板块龙头股票名称 | "比亚迪" |

#### 排序规则
按涨停数降序排列

#### 业务逻辑
```
SELECT * FROM hot_concepts
WHERE trade_date = '当日'
  AND rank <= 10  -- 限定TOP10
  AND limit_up_count > 10  -- 涨停数大于10
ORDER BY limit_up_count DESC
```

---

### 2.3 主线板块

#### 定义
识别**趋势板块**和**情绪板块**的交集，即同时具备持续上涨趋势和高市场情绪的核心主线。

#### 数据来源
- 趋势板块 ∩ 情绪板块

#### 筛选规则
同时满足以下条件：
1. 在趋势板块前6名中 **且**
2. 当日涨停数 > 10

#### 展示字段

| 字段名 | 数据库字段 | 说明 | 示例 |
|--------|-----------|------|------|
| 板块名称 | `concept_name` | 概念名称 | "人工智能" |
| 当日涨幅 | `day_change_pct` | 当日涨跌幅(%) | +4.82% |
| 5日涨幅 | `change_pct` | 5日累计涨幅(%) | +15.32% |
| 涨停数 | `limit_up_count` | 涨停家数 | 18 |
| 龙头股 | `leader_stock_name` | 板块龙头股票名称 | "科大讯飞" |

#### 排序规则
保持首页排序(按5日涨幅降序)

#### 业务逻辑
```
SELECT * FROM hot_concepts
WHERE trade_date = '当日'
  AND rank <= 6  -- 趋势板块前6
  AND limit_up_count > 10  -- 情绪板块条件
ORDER BY change_pct DESC
```

#### 特殊说明
- 主线板块可能为空(无交集时)
- 主线板块数量: 0-6个

---

### 2.4 今日异动板块

#### 定义
捕捉**TOP10之外**的突发机会板块，挖掘市场潜在热点。

#### 数据来源
- 数据表: `hot_concepts`
- 数据范围: **所有概念板块**(不限于TOP10)

#### 筛选规则

**异动维度1: 涨停数异动**
- 当日涨停数排名第1、第2的板块
- **排除**首页TOP10中的板块

**异动维度2: 涨幅异动**
- 当日涨幅排名第1、第2的板块
- **排除**首页TOP10中的板块

**去重规则**:
- 如果同一个板块同时满足两个维度，只展示一次
- 最终展示2-4个板块

#### 展示字段

| 字段名 | 数据库字段 | 说明 | 示例 |
|--------|-----------|------|------|
| 板块名称 | `concept_name` | 概念名称 | "量子通信" |
| 当日涨幅 | `day_change_pct` | 当日涨跌幅(%) | +6.52% |
| 涨停数 | `limit_up_count` | 涨停家数 | 8 |
| 龙头股 | `leader_stock_name` | 板块龙头股票名称 | "国盾量子" |

#### 排序规则
- 涨停数前2名在前
- 涨幅前2名在后
- 如有重复，保留一次

#### 业务逻辑
```sql
-- 1. 获取TOP10板块列表
top10_concepts = SELECT concept_name FROM hot_concepts
                 WHERE trade_date = '当日' AND rank <= 10

-- 2. 涨停数前2名(排除TOP10)
limit_top2 = SELECT * FROM hot_concepts
             WHERE trade_date = '当日'
               AND concept_name NOT IN (top10_concepts)
             ORDER BY limit_up_count DESC
             LIMIT 2

-- 3. 涨幅前2名(排除TOP10)
change_top2 = SELECT * FROM hot_concepts
              WHERE trade_date = '当日'
                AND concept_name NOT IN (top10_concepts)
              ORDER BY day_change_pct DESC
              LIMIT 2

-- 4. 合并去重
result = UNION(limit_top2, change_top2)  -- 按concept_name去重
```

#### 特殊说明
- 异动板块可能少于4个(如果存在重复)
- 异动板块可能为空(如果TOP10外无符合条件的板块)

---

## 3. 界面设计

### 3.1 页面布局

```
┌─────────────────────────────────────────────────────────┐
│  板块分析                          数据日期: 2025-12-12  │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │  📈 趋势板块 (6个)                               │   │
│  │  ┌──────┬─────┬─────┬────────┐                 │   │
│  │  │板块  │当日 │5日  │龙头股  │                 │   │
│  │  ├──────┼─────┼─────┼────────┤                 │   │
│  │  │AI    │+3.5%│+12% │科大讯飞│                 │   │
│  │  └──────┴─────┴─────┴────────┘                 │   │
│  └─────────────────────────────────────────────────┘   │
│                                                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │  🔥 情绪板块 (涨停>10)                           │   │
│  │  ┌──────┬─────┬──────┬────────┐               │   │
│  │  │板块  │当日 │涨停数│龙头股  │               │   │
│  │  └──────┴─────┴──────┴────────┘               │   │
│  └─────────────────────────────────────────────────┘   │
│                                                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │  ⭐ 主线板块 (趋势+情绪)                        │   │
│  │  ┌──────┬─────┬─────┬──────┬────────┐         │   │
│  │  │板块  │当日 │5日  │涨停数│龙头股  │         │   │
│  │  └──────┴─────┴─────┴──────┴────────┘         │   │
│  └─────────────────────────────────────────────────┘   │
│                                                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │  ⚡ 今日异动板块 (2-4个)                        │   │
│  │  ┌──────┬─────┬──────┬────────┐               │   │
│  │  │板块  │当日 │涨停数│龙头股  │               │   │
│  │  └──────┴─────┴──────┴────────┘               │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 3.2 交互说明

- **点击板块**: 跳转到板块详情页(查看成分股列表)
- **点击龙头股**: 跳转到个股详情页
- **空状态提示**: 当某模块无数据时，显示"暂无数据"提示

### 3.3 颜色规范

- 涨幅: 红色 `text-red-600` (正数), 绿色 `text-green-600` (负数)
- 龙头股: 蓝色链接 `text-blue-600 hover:underline`
- 模块标题颜色:
  - 趋势板块: 蓝色 `text-blue-600`
  - 情绪板块: 红色 `text-red-600`
  - 主线板块: 紫色 `text-purple-600`
  - 异动板块: 橙色 `text-orange-600`

---

## 4. 数据说明

### 4.1 数据表结构

**表名**: `hot_concepts`

**关键字段**:

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `trade_date` | string | 交易日期 | "2025-12-12" |
| `concept_name` | string | 概念名称 | "人工智能" |
| `day_change_pct` | float | 当日涨跌幅(%) | 3.52 |
| `change_pct` | float | 5日涨跌幅(%) | 12.68 |
| `limit_up_count` | int | 涨停数(含创业板) | 15 |
| `leader_stock_name` | string | 龙头股名称 | "科大讯飞" |
| `leader_stock_code` | string | 龙头股代码 | "002230" |
| `rank` | int | 排名 | 1 |

### 4.2 数据更新频率

- 采集时间: 每个交易日 16:00
- 数据来源: Tushare Pro API
- 自动采集: `daily_auto_collect.py`

### 4.3 数据范围说明

**重要**:
- `hot_concepts` 表目前存储**TOP50**概念板块
- 异动板块功能依赖此数据范围
- 如表中只存储TOP10，则异动板块无法实现

**待确认**:
- 需确认 `hot_concepts` 表实际存储的板块数量
- 如不足50个，需调整数据采集范围

---

## 5. 业务规则

### 5.1 涨停数统计规则

涨停数包含：
- 主板10%涨停
- 科创板20%涨停
- 创业板20%涨停

数据来源：Tushare已计算好的涨停数，无需前端/后端二次计算

### 5.2 龙头股定义

龙头股 = 板块内满足以下条件的股票：
1. 当日涨停
2. 连板天数最多
3. 涨幅最高(同连板数时)

数据来源：首页已计算，存储在 `leader_stock_name` 字段

### 5.3 排除规则

**异动板块排除逻辑**:
```
排除条件: rank <= 10
即: 首页TOP10中的板块不会出现在异动板块中
```

### 5.4 去重规则

**异动板块去重**:
- 涨停数前2 + 涨幅前2 可能有重复
- 按 `concept_name` 去重
- 保留先出现的(涨停数维度优先)

---

## 6. 非功能需求

### 6.1 性能要求

- 页面加载时间: < 1秒
- 数据查询时间: < 500ms
- API响应时间: < 300ms

### 6.2 兼容性

- 浏览器: Chrome 90+, Safari 14+, Edge 90+
- 移动端: 响应式布局，支持移动设备访问

### 6.3 可扩展性

- 预留板块详情页入口
- 预留个股详情页入口
- 支持未来增加筛选条件(如市值、成交额等)

---

## 7. 验收标准

### 7.1 功能验收

- [ ] 趋势板块正确显示前6名(按5日涨幅排序)
- [ ] 情绪板块正确筛选涨停数>10的板块
- [ ] 主线板块正确显示交集板块
- [ ] 异动板块正确排除TOP10，显示第1、第2名
- [ ] 所有字段数据准确无误
- [ ] 空状态正确处理(无数据时提示)

### 7.2 界面验收

- [ ] 四个模块布局清晰
- [ ] 颜色规范符合设计
- [ ] 响应式布局正常
- [ ] 点击交互正常(板块/股票跳转)

### 7.3 数据验收

- [ ] 数据日期正确
- [ ] 涨幅计算准确
- [ ] 龙头股信息正确
- [ ] 排序规则正确

---

## 8. 后续规划

### Phase 1 (当前版本)
- ✅ 四个核心模块展示
- ✅ 基础数据展示和排序

### Phase 2 (未来版本)
- 🔲 板块详情页(成分股列表、K线图)
- 🔲 板块资金流向分析
- 🔲 板块历史表现追踪
- 🔲 板块对比功能

### Phase 3 (可选)
- 🔲 板块轮动分析
- 🔲 板块联动关系图
- 🔲 自定义板块筛选条件

---

## 9. 附录

### 9.1 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 概念板块 | Concept | 主题类板块，如AI、新能源等 |
| 行业板块 | Industry | 传统行业分类，本系统不涉及 |
| 龙头股 | Leader Stock | 板块内最强股票 |
| 涨停 | Limit Up | 主板10%、创业板/科创板20% |
| 连板 | Consecutive Limit Up | 连续涨停天数 |

### 9.2 参考文档

- 《数据采集架构设计》(`ARCHITECTURE.md`)
- 《交易日日历说明》(`README_交易日日历.md`)
- Tushare Pro API文档

---

**文档状态**: ✅ 已完成
**审核状态**: 待审核
**维护者**: 短线复盘项目团队
