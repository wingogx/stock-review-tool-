# æ¿å—åˆ†æåŠŸèƒ½æŠ€æœ¯æ‰‹å†Œ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-12-12
- **æœ€åæ›´æ–°**: 2025-12-12
- **é€‚ç”¨äººå‘˜**: åç«¯å¼€å‘ã€å‰ç«¯å¼€å‘ã€æµ‹è¯•å·¥ç¨‹å¸ˆ

---

## 1. æŠ€æœ¯æ¶æ„

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (Next.js)                        â”‚
â”‚                                                           â”‚
â”‚  /app/sector/page.tsx                                    â”‚
â”‚    â”œâ”€ useQuery('sectorAnalysis')                        â”‚
â”‚    â”œâ”€ è¶‹åŠ¿æ¿å—ç»„ä»¶                                       â”‚
â”‚    â”œâ”€ æƒ…ç»ªæ¿å—ç»„ä»¶                                       â”‚
â”‚    â”œâ”€ ä¸»çº¿æ¿å—ç»„ä»¶                                       â”‚
â”‚    â””â”€ å¼‚åŠ¨æ¿å—ç»„ä»¶                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP GET
              â”‚ /api/concepts/sector-analysis
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åç«¯ (FastAPI)                           â”‚
â”‚                                                           â”‚
â”‚  /app/routers/concepts.py                               â”‚
â”‚    â””â”€ GET /sector-analysis                              â”‚
â”‚         â”œâ”€ æŸ¥è¯¢hot_conceptsè¡¨                           â”‚
â”‚         â”œâ”€ è®¡ç®—å››ä¸ªæ¨¡å—æ•°æ®                             â”‚
â”‚         â””â”€ è¿”å›JSON                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®åº“ (Supabase)                           â”‚
â”‚                                                           â”‚
â”‚  hot_concepts è¡¨                                         â”‚
â”‚    â”œâ”€ trade_date                                        â”‚
â”‚    â”œâ”€ concept_name                                      â”‚
â”‚    â”œâ”€ day_change_pct                                    â”‚
â”‚    â”œâ”€ change_pct                                        â”‚
â”‚    â”œâ”€ limit_up_count                                    â”‚
â”‚    â”œâ”€ leader_stock_name                                 â”‚
â”‚    â””â”€ rank                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- Next.js 14 (App Router)
- React 18
- TypeScript
- TanStack Query (æ•°æ®è·å–)
- Tailwind CSS (æ ·å¼)
- shadcn/ui (UIç»„ä»¶)

**åç«¯**:
- Python 3.13
- FastAPI
- Supabase Client
- Pydantic (æ•°æ®éªŒè¯)

**æ•°æ®åº“**:
- Supabase (PostgreSQL)

**æ•°æ®æº**:
- Tushare Pro API

---

## 2. åç«¯å®ç°

### 2.1 APIè®¾è®¡

#### æ¥å£å®šä¹‰

```
GET /api/concepts/sector-analysis
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| trade_date | string | å¦ | æœ€æ–°äº¤æ˜“æ—¥ | äº¤æ˜“æ—¥æœŸ YYYY-MM-DD |

#### å“åº”æ ¼å¼

```json
{
  "success": true,
  "trade_date": "2025-12-12",
  "data": {
    "trend_sectors": [
      {
        "concept_name": "äººå·¥æ™ºèƒ½",
        "day_change_pct": 3.52,
        "change_pct": 12.68,
        "leader_stock_name": "ç§‘å¤§è®¯é£",
        "leader_stock_code": "002230"
      }
    ],
    "emotion_sectors": [
      {
        "concept_name": "æ–°èƒ½æºæ±½è½¦",
        "day_change_pct": 5.28,
        "limit_up_count": 15,
        "leader_stock_name": "æ¯”äºšè¿ª",
        "leader_stock_code": "002594"
      }
    ],
    "main_sectors": [
      {
        "concept_name": "äººå·¥æ™ºèƒ½",
        "day_change_pct": 3.52,
        "change_pct": 12.68,
        "limit_up_count": 18,
        "leader_stock_name": "ç§‘å¤§è®¯é£",
        "leader_stock_code": "002230"
      }
    ],
    "anomaly_sectors": [
      {
        "concept_name": "é‡å­é€šä¿¡",
        "day_change_pct": 6.52,
        "limit_up_count": 8,
        "leader_stock_name": "å›½ç›¾é‡å­",
        "leader_stock_code": "688027",
        "anomaly_type": "limit_up"
      },
      {
        "concept_name": "å«æ˜Ÿäº’è”ç½‘",
        "day_change_pct": 7.23,
        "limit_up_count": 6,
        "leader_stock_name": "ä¸­å›½å«æ˜Ÿ",
        "leader_stock_code": "600118",
        "anomaly_type": "change_pct"
      }
    ]
  }
}
```

### 2.2 æ•°æ®æ¨¡å‹ (Pydantic)

**æ–‡ä»¶**: `backend/app/schemas/concepts.py`

```python
from pydantic import BaseModel
from typing import List, Optional

# è¶‹åŠ¿æ¿å—é¡¹
class TrendSectorItem(BaseModel):
    concept_name: str
    day_change_pct: float
    change_pct: float
    leader_stock_name: Optional[str] = None
    leader_stock_code: Optional[str] = None

# æƒ…ç»ªæ¿å—é¡¹
class EmotionSectorItem(BaseModel):
    concept_name: str
    day_change_pct: float
    limit_up_count: int
    leader_stock_name: Optional[str] = None
    leader_stock_code: Optional[str] = None

# ä¸»çº¿æ¿å—é¡¹
class MainSectorItem(BaseModel):
    concept_name: str
    day_change_pct: float
    change_pct: float
    limit_up_count: int
    leader_stock_name: Optional[str] = None
    leader_stock_code: Optional[str] = None

# å¼‚åŠ¨æ¿å—é¡¹
class AnomalySectorItem(BaseModel):
    concept_name: str
    day_change_pct: float
    limit_up_count: int
    leader_stock_name: Optional[str] = None
    leader_stock_code: Optional[str] = None
    anomaly_type: str  # "limit_up" æˆ– "change_pct"

# æ¿å—åˆ†ææ•°æ®
class SectorAnalysisData(BaseModel):
    trend_sectors: List[TrendSectorItem]
    emotion_sectors: List[EmotionSectorItem]
    main_sectors: List[MainSectorItem]
    anomaly_sectors: List[AnomalySectorItem]

# æ¿å—åˆ†æå“åº”
class SectorAnalysisResponse(BaseModel):
    success: bool
    trade_date: str
    data: SectorAnalysisData
```

### 2.3 è·¯ç”±å®ç°

**æ–‡ä»¶**: `backend/app/routers/concepts.py`

```python
@router.get("/sector-analysis", response_model=SectorAnalysisResponse, summary="è·å–æ¿å—åˆ†ææ•°æ®")
async def get_sector_analysis(
    trade_date: Optional[str] = Query(None, description="äº¤æ˜“æ—¥æœŸ YYYY-MM-DD"),
):
    """
    è·å–æ¿å—åˆ†æå››å¤§æ¨¡å—æ•°æ®

    - è¶‹åŠ¿æ¿å—: 5æ—¥æ¶¨å¹…å‰6
    - æƒ…ç»ªæ¿å—: æ¶¨åœæ•°>10
    - ä¸»çº¿æ¿å—: è¶‹åŠ¿+æƒ…ç»ªäº¤é›†
    - å¼‚åŠ¨æ¿å—: TOP10å¤–çš„æ¶¨åœ/æ¶¨å¹…å‰2
    """
    try:
        if not trade_date:
            trade_date = get_latest_trading_date()

        supabase = get_supabase()

        # 1. è·å–TOP10æ•°æ®(ç”¨äºæ’é™¤)
        top10_response = supabase.table("hot_concepts").select("*").eq(
            "trade_date", trade_date
        ).lte("rank", 10).execute()

        top10_names = [item['concept_name'] for item in top10_response.data]

        # 2. è·å–æ‰€æœ‰æ¦‚å¿µæ•°æ®
        all_response = supabase.table("hot_concepts").select("*").eq(
            "trade_date", trade_date
        ).execute()

        all_concepts = all_response.data

        # 3. è®¡ç®—è¶‹åŠ¿æ¿å—(5æ—¥æ¶¨å¹…å‰6)
        trend_sectors = sorted(
            [c for c in all_concepts if c.get('rank', 999) <= 6],
            key=lambda x: x.get('change_pct', 0),
            reverse=True
        )[:6]

        # 4. è®¡ç®—æƒ…ç»ªæ¿å—(æ¶¨åœæ•°>10)
        emotion_sectors = sorted(
            [c for c in all_concepts
             if c.get('rank', 999) <= 10 and c.get('limit_up_count', 0) > 10],
            key=lambda x: x.get('limit_up_count', 0),
            reverse=True
        )

        # 5. è®¡ç®—ä¸»çº¿æ¿å—(è¶‹åŠ¿+æƒ…ç»ªäº¤é›†)
        trend_names = [s['concept_name'] for s in trend_sectors]
        emotion_names = [s['concept_name'] for s in emotion_sectors]
        main_names = set(trend_names) & set(emotion_names)

        main_sectors = [
            c for c in trend_sectors
            if c['concept_name'] in main_names
        ]

        # 6. è®¡ç®—å¼‚åŠ¨æ¿å—
        # 6.1 æ’é™¤TOP10çš„æ¿å—
        non_top10 = [c for c in all_concepts if c['concept_name'] not in top10_names]

        # 6.2 æ¶¨åœæ•°å‰2
        limit_up_top2 = sorted(
            non_top10,
            key=lambda x: x.get('limit_up_count', 0),
            reverse=True
        )[:2]

        # 6.3 æ¶¨å¹…å‰2
        change_top2 = sorted(
            non_top10,
            key=lambda x: x.get('day_change_pct', 0),
            reverse=True
        )[:2]

        # 6.4 åˆå¹¶å»é‡
        anomaly_dict = {}
        for sector in limit_up_top2:
            anomaly_dict[sector['concept_name']] = {**sector, 'anomaly_type': 'limit_up'}
        for sector in change_top2:
            if sector['concept_name'] not in anomaly_dict:
                anomaly_dict[sector['concept_name']] = {**sector, 'anomaly_type': 'change_pct'}

        anomaly_sectors = list(anomaly_dict.values())

        # 7. æ„å»ºå“åº”
        return SectorAnalysisResponse(
            success=True,
            trade_date=trade_date,
            data=SectorAnalysisData(
                trend_sectors=[TrendSectorItem(**s) for s in trend_sectors],
                emotion_sectors=[EmotionSectorItem(**s) for s in emotion_sectors],
                main_sectors=[MainSectorItem(**s) for s in main_sectors],
                anomaly_sectors=[AnomalySectorItem(**s) for s in anomaly_sectors]
            )
        )

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"è·å–æ¿å—åˆ†æå¤±è´¥: {str(e)}")
```

### 2.4 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**ç´¢å¼•å»ºè®®**:
```sql
-- åŠ é€ŸæŒ‰æ—¥æœŸ+æ’åæŸ¥è¯¢
CREATE INDEX idx_hot_concepts_date_rank ON hot_concepts(trade_date, rank);

-- åŠ é€ŸæŒ‰æ—¥æœŸ+æ¶¨åœæ•°æŸ¥è¯¢
CREATE INDEX idx_hot_concepts_date_limit ON hot_concepts(trade_date, limit_up_count DESC);

-- åŠ é€ŸæŒ‰æ—¥æœŸ+æ¶¨å¹…æŸ¥è¯¢
CREATE INDEX idx_hot_concepts_date_change ON hot_concepts(trade_date, day_change_pct DESC);
```

---

## 3. å‰ç«¯å®ç°

### 3.1 APIå®¢æˆ·ç«¯

**æ–‡ä»¶**: `frontend/lib/api.ts`

```typescript
// æ¿å—åˆ†ææ•°æ®ç±»å‹
export interface TrendSector {
  concept_name: string;
  day_change_pct: number;
  change_pct: number;
  leader_stock_name?: string;
  leader_stock_code?: string;
}

export interface EmotionSector {
  concept_name: string;
  day_change_pct: number;
  limit_up_count: number;
  leader_stock_name?: string;
  leader_stock_code?: string;
}

export interface MainSector {
  concept_name: string;
  day_change_pct: number;
  change_pct: number;
  limit_up_count: number;
  leader_stock_name?: string;
  leader_stock_code?: string;
}

export interface AnomalySector {
  concept_name: string;
  day_change_pct: number;
  limit_up_count: number;
  leader_stock_name?: string;
  leader_stock_code?: string;
  anomaly_type: 'limit_up' | 'change_pct';
}

export interface SectorAnalysisData {
  trend_sectors: TrendSector[];
  emotion_sectors: EmotionSector[];
  main_sectors: MainSector[];
  anomaly_sectors: AnomalySector[];
}

export interface SectorAnalysisResponse {
  success: boolean;
  trade_date: string;
  data: SectorAnalysisData;
}

// APIè°ƒç”¨å‡½æ•°
export async function getSectorAnalysis(
  tradeDate?: string
): Promise<SectorAnalysisResponse> {
  const params = new URLSearchParams();
  if (tradeDate) params.append('trade_date', tradeDate);

  const response = await fetch(
    `${API_BASE_URL}/api/concepts/sector-analysis?${params}`,
    { next: { revalidate: 300 } } // ç¼“å­˜5åˆ†é’Ÿ
  );

  if (!response.ok) {
    throw new Error('Failed to fetch sector analysis');
  }

  return response.json();
}
```

### 3.2 é¡µé¢ç»„ä»¶

**æ–‡ä»¶**: `frontend/app/sector/page.tsx`

```typescript
'use client';

import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { getSectorAnalysis } from '@/lib/api';

export default function SectorPage() {
  // è·å–æ¿å—åˆ†ææ•°æ®
  const { data: sectorAnalysis, isLoading } = useQuery({
    queryKey: ['sectorAnalysis'],
    queryFn: () => getSectorAnalysis(),
  });

  if (isLoading) {
    return <LoadingSpinner />;
  }

  const { trend_sectors, emotion_sectors, main_sectors, anomaly_sectors } =
    sectorAnalysis?.data || {};

  return (
    <div className="container mx-auto py-6 space-y-6">
      {/* é¡µé¢æ ‡é¢˜ */}
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">æ¿å—åˆ†æ</h1>
        <p className="text-sm text-gray-500">
          æ•°æ®æ—¥æœŸ: {sectorAnalysis?.trade_date || '-'}
        </p>
      </div>

      {/* è¶‹åŠ¿æ¿å— */}
      <TrendSectorsCard sectors={trend_sectors} />

      {/* æƒ…ç»ªæ¿å— */}
      <EmotionSectorsCard sectors={emotion_sectors} />

      {/* ä¸»çº¿æ¿å— */}
      <MainSectorsCard sectors={main_sectors} />

      {/* å¼‚åŠ¨æ¿å— */}
      <AnomalySectorsCard sectors={anomaly_sectors} />
    </div>
  );
}
```

### 3.3 å­ç»„ä»¶ç¤ºä¾‹

**è¶‹åŠ¿æ¿å—ç»„ä»¶**:

```typescript
function TrendSectorsCard({ sectors }: { sectors?: TrendSector[] }) {
  if (!sectors || sectors.length === 0) {
    return <EmptyCard title="ğŸ“ˆ è¶‹åŠ¿æ¿å—" />;
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-blue-600">ğŸ“ˆ è¶‹åŠ¿æ¿å—</CardTitle>
        <p className="text-sm text-gray-500">5æ—¥æ¶¨å¹…æ’åå‰6</p>
      </CardHeader>
      <CardContent>
        <table className="w-full">
          <thead>
            <tr className="border-b">
              <th className="text-left p-3">æ¿å—åç§°</th>
              <th className="text-right p-3">å½“æ—¥æ¶¨å¹…</th>
              <th className="text-right p-3">5æ—¥æ¶¨å¹…</th>
              <th className="text-left p-3">é¾™å¤´è‚¡</th>
            </tr>
          </thead>
          <tbody>
            {sectors.map((sector) => (
              <tr key={sector.concept_name} className="border-b hover:bg-gray-50">
                <td className="p-3 font-medium">{sector.concept_name}</td>
                <td className={`p-3 text-right ${
                  sector.day_change_pct >= 0 ? 'text-red-600' : 'text-green-600'
                }`}>
                  {sector.day_change_pct >= 0 ? '+' : ''}
                  {sector.day_change_pct.toFixed(2)}%
                </td>
                <td className={`p-3 text-right font-semibold ${
                  sector.change_pct >= 0 ? 'text-red-600' : 'text-green-600'
                }`}>
                  {sector.change_pct >= 0 ? '+' : ''}
                  {sector.change_pct.toFixed(2)}%
                </td>
                <td className="p-3">
                  <a href={`/stock/${sector.leader_stock_code}`}
                     className="text-blue-600 hover:underline">
                    {sector.leader_stock_name || '-'}
                  </a>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </CardContent>
    </Card>
  );
}
```

---

## 4. æ•°æ®æµç¨‹

### 4.1 æ•°æ®é‡‡é›†æµç¨‹

```
1. æ¯æ—¥16:00 â†’ daily_auto_collect.py å¯åŠ¨
                  â†“
2. HotConceptsCollector.collect_and_save()
                  â†“
3. Tushare API â†’ è·å–æ¦‚å¿µæ¿å—æ•°æ®
                  â†“
4. è®¡ç®—é¾™å¤´è‚¡ã€æ¶¨åœæ•°ç­‰æŒ‡æ ‡
                  â†“
5. å­˜å…¥ hot_concepts è¡¨
                  â†“
6. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥(è‡³å°‘10æ¡)
```

### 4.2 APIè°ƒç”¨æµç¨‹

```
1. ç”¨æˆ·è®¿é—® /sector é¡µé¢
          â†“
2. React Query å‘èµ·è¯·æ±‚
          â†“
3. GET /api/concepts/sector-analysis
          â†“
4. åç«¯æŸ¥è¯¢ hot_concepts è¡¨
          â†“
5. è®¡ç®—å››ä¸ªæ¨¡å—æ•°æ®
          â†“
6. è¿”å› JSON å“åº”
          â†“
7. å‰ç«¯æ¸²æŸ“å››ä¸ªå¡ç‰‡
```

### 4.3 ç¼“å­˜ç­–ç•¥

**å‰ç«¯ç¼“å­˜**:
- React Query ç¼“å­˜æ—¶é—´: 5åˆ†é’Ÿ
- SWR ç­–ç•¥: staleWhileRevalidate

**åç«¯ç¼“å­˜**:
- æ•°æ®åº“è¿æ¥æ± å¤ç”¨
- æ— éœ€é¢å¤–ç¼“å­˜(æŸ¥è¯¢æ€§èƒ½å·²è¶³å¤Ÿ)

---

## 5. æµ‹è¯•æ–¹æ¡ˆ

### 5.1 å•å…ƒæµ‹è¯•

**åç«¯æµ‹è¯•** (`tests/test_sector_analysis.py`):

```python
import pytest
from app.routers.concepts import get_sector_analysis

def test_trend_sectors_count():
    """æµ‹è¯•è¶‹åŠ¿æ¿å—æ•°é‡ä¸è¶…è¿‡6"""
    response = get_sector_analysis(trade_date="2025-12-12")
    assert len(response.data.trend_sectors) <= 6

def test_emotion_sectors_limit_up():
    """æµ‹è¯•æƒ…ç»ªæ¿å—æ¶¨åœæ•°>10"""
    response = get_sector_analysis(trade_date="2025-12-12")
    for sector in response.data.emotion_sectors:
        assert sector.limit_up_count > 10

def test_main_sectors_intersection():
    """æµ‹è¯•ä¸»çº¿æ¿å—æ˜¯è¶‹åŠ¿å’Œæƒ…ç»ªçš„äº¤é›†"""
    response = get_sector_analysis(trade_date="2025-12-12")
    trend_names = {s.concept_name for s in response.data.trend_sectors}
    emotion_names = {s.concept_name for s in response.data.emotion_sectors}
    main_names = {s.concept_name for s in response.data.main_sectors}

    assert main_names == (trend_names & emotion_names)

def test_anomaly_sectors_not_in_top10():
    """æµ‹è¯•å¼‚åŠ¨æ¿å—ä¸åœ¨TOP10ä¸­"""
    # éœ€è¦æŸ¥è¯¢TOP10æ•°æ®å¯¹æ¯”
    pass
```

**å‰ç«¯æµ‹è¯•** (`__tests__/sector.test.tsx`):

```typescript
import { render, screen } from '@testing-library/react';
import SectorPage from '@/app/sector/page';

test('renders sector analysis page', () => {
  render(<SectorPage />);
  expect(screen.getByText('æ¿å—åˆ†æ')).toBeInTheDocument();
});

test('displays four sector modules', () => {
  render(<SectorPage />);
  expect(screen.getByText('è¶‹åŠ¿æ¿å—')).toBeInTheDocument();
  expect(screen.getByText('æƒ…ç»ªæ¿å—')).toBeInTheDocument();
  expect(screen.getByText('ä¸»çº¿æ¿å—')).toBeInTheDocument();
  expect(screen.getByText('å¼‚åŠ¨æ¿å—')).toBeInTheDocument();
});
```

### 5.2 é›†æˆæµ‹è¯•

**APIé›†æˆæµ‹è¯•**:

```bash
# æµ‹è¯•APIå“åº”
curl -X GET "http://localhost:8000/api/concepts/sector-analysis"

# æµ‹è¯•æŒ‡å®šæ—¥æœŸ
curl -X GET "http://localhost:8000/api/concepts/sector-analysis?trade_date=2025-12-12"
```

### 5.3 æ€§èƒ½æµ‹è¯•

**è´Ÿè½½æµ‹è¯•** (ä½¿ç”¨ Apache Bench):

```bash
# 100å¹¶å‘ï¼Œ1000è¯·æ±‚
ab -n 1000 -c 100 http://localhost:8000/api/concepts/sector-analysis

# æœŸæœ›ç»“æœ:
# - å¹³å‡å“åº”æ—¶é—´: < 300ms
# - é”™è¯¯ç‡: 0%
```

---

## 6. éƒ¨ç½²è¯´æ˜

### 6.1 ç¯å¢ƒå˜é‡

**åç«¯** (`.env`):

```bash
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=your_supabase_key
```

**å‰ç«¯** (`.env.local`):

```bash
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### 6.2 å¯åŠ¨å‘½ä»¤

**åç«¯**:

```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --port 8000
```

**å‰ç«¯**:

```bash
cd frontend
npm run dev
```

### 6.3 ç”Ÿäº§éƒ¨ç½²

**åç«¯** (Docker):

```dockerfile
FROM python:3.13-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**å‰ç«¯** (Vercel):

```bash
npm run build
vercel deploy --prod
```

---

## 7. æ•…éšœæ’æŸ¥

### 7.1 å¸¸è§é—®é¢˜

**é—®é¢˜1**: å¼‚åŠ¨æ¿å—ä¸ºç©º

**åŸå› **: `hot_concepts` è¡¨åªå­˜å‚¨TOP10æ•°æ®
**è§£å†³**: ä¿®æ”¹ `HotConceptsCollector` é‡‡é›†TOP50æ•°æ®

**é—®é¢˜2**: ä¸»çº¿æ¿å—æ•°é‡å¼‚å¸¸

**åŸå› **: è¶‹åŠ¿/æƒ…ç»ªæ¿å—ç­›é€‰æ¡ä»¶ä¸ä¸€è‡´
**è§£å†³**: æ£€æŸ¥rankå­—æ®µå’Œlimit_up_countå­—æ®µ

**é—®é¢˜3**: APIå“åº”æ…¢

**åŸå› **: æ•°æ®åº“æŸ¥è¯¢æœªä¼˜åŒ–
**è§£å†³**: æ·»åŠ ç´¢å¼•ï¼Œå‚è€ƒ2.4èŠ‚

### 7.2 è°ƒè¯•æŠ€å·§

**åç«¯è°ƒè¯•**:

```python
# æ‰“å°SQLæŸ¥è¯¢
import logging
logging.basicConfig(level=logging.DEBUG)
```

**å‰ç«¯è°ƒè¯•**:

```typescript
// React Query Devtools
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

<ReactQueryDevtools initialIsOpen={false} />
```

---

## 8. APIæ–‡æ¡£

### 8.1 Swagger UI

è®¿é—®: `http://localhost:8000/docs`

è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£åŒ…å«:
- æ‰€æœ‰ç«¯ç‚¹åˆ—è¡¨
- è¯·æ±‚/å“åº”ç¤ºä¾‹
- åœ¨çº¿æµ‹è¯•åŠŸèƒ½

### 8.2 ReDoc

è®¿é—®: `http://localhost:8000/redoc`

æ›´ç¾è§‚çš„APIæ–‡æ¡£å±•ç¤º

---

## 9. æ€§èƒ½æŒ‡æ ‡

### 9.1 ç›®æ ‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| APIå“åº”æ—¶é—´ | < 300ms | å¾…æµ‹è¯• | - |
| é¡µé¢åŠ è½½æ—¶é—´ | < 1s | å¾…æµ‹è¯• | - |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | < 100ms | å¾…æµ‹è¯• | - |
| å¹¶å‘å¤„ç†èƒ½åŠ› | 100 QPS | å¾…æµ‹è¯• | - |

### 9.2 ç›‘æ§æ–¹æ¡ˆ

**åç«¯ç›‘æ§**:
- ä½¿ç”¨ FastAPI ä¸­é—´ä»¶è®°å½•å“åº”æ—¶é—´
- Sentry é”™è¯¯ç›‘æ§

**å‰ç«¯ç›‘æ§**:
- Vercel Analytics
- Web Vitals (LCP, FID, CLS)

---

## 10. å®‰å…¨è¯´æ˜

### 10.1 SQLæ³¨å…¥é˜²æŠ¤

ä½¿ç”¨ Supabase Client çš„å‚æ•°åŒ–æŸ¥è¯¢ï¼Œè‡ªåŠ¨é˜²æŠ¤SQLæ³¨å…¥

### 10.2 XSSé˜²æŠ¤

Reactè‡ªåŠ¨è½¬ä¹‰ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢XSSæ”»å‡»

### 10.3 CORSé…ç½®

**åç«¯** (`app/main.py`):

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # ç”Ÿäº§ç¯å¢ƒæ”¹ä¸ºå®é™…åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## 11. é™„å½•

### 11.1 ç›¸å…³æ–‡ä»¶æ¸…å•

**åç«¯**:
- `backend/app/routers/concepts.py` - è·¯ç”±å®ç°
- `backend/app/schemas/concepts.py` - æ•°æ®æ¨¡å‹
- `backend/app/services/collectors/hot_concepts_collector.py` - æ•°æ®é‡‡é›†

**å‰ç«¯**:
- `frontend/app/sector/page.tsx` - é¡µé¢ç»„ä»¶
- `frontend/lib/api.ts` - APIå®¢æˆ·ç«¯
- `frontend/components/ui/card.tsx` - UIç»„ä»¶

### 11.2 æŠ€æœ¯å‚è€ƒ

- FastAPIæ–‡æ¡£: https://fastapi.tiangolo.com/
- Next.jsæ–‡æ¡£: https://nextjs.org/docs
- Supabaseæ–‡æ¡£: https://supabase.com/docs
- TanStack Query: https://tanstack.com/query/latest

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
**ç»´æŠ¤è€…**: çŸ­çº¿å¤ç›˜é¡¹ç›®å›¢é˜Ÿ
