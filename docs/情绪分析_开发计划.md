# 情绪分析页面 - 开发计划

**版本**: v1.0
**日期**: 2025-12-12
**状态**: 待开发

---

## 一、开发阶段

### Phase 1：后端API开发

#### 任务1.1：创建数据模型
- [ ] 创建 `backend/app/schemas/sentiment.py`
- [ ] 定义 EmotionDashboard 模型
- [ ] 定义 YesterdayPerformance 模型
- [ ] 定义 ConceptLadder 模型
- [ ] 定义 LeaderAnalysis 模型
- [ ] 定义 SentimentAnalysisResponse 模型

#### 任务1.2：实现业务逻辑
- [ ] 创建 `backend/app/services/sentiment_service.py`
- [ ] 实现 `_get_emotion_dashboard()` - 情绪仪表盘
  - [ ] 计算空间板高度
  - [ ] 计算分层晋级率
  - [ ] 判断情绪周期阶段
- [ ] 实现 `_get_yesterday_performance()` - 昨日涨停表现
  - [ ] 查询昨日涨停股
  - [ ] 统计今日涨跌分布
  - [ ] 计算大面数量和大面率
- [ ] 实现 `_get_concept_ladder()` - 概念梯队分析
  - [ ] 筛选4板+股票
  - [ ] 按概念分组
  - [ ] 计算梯队完整度
- [ ] 实现 `_get_leader_analysis()` - 龙头股分析
  - [ ] 技术面分析
  - [ ] 资金面分析
  - [ ] 梯队情况分析
  - [ ] 综合评估

#### 任务1.3：创建API路由
- [ ] 创建 `backend/app/routers/sentiment.py`
- [ ] 实现 `GET /api/sentiment/analysis` 接口
- [ ] 在 main.py 注册路由
- [ ] 测试API接口

---

### Phase 2：前端页面开发

#### 任务2.1：创建类型定义
- [ ] 创建 `frontend/types/sentiment.ts`
- [ ] 定义所有API响应类型

#### 任务2.2：创建页面组件
- [ ] 创建 `frontend/app/sentiment/page.tsx` 主页面
- [ ] 创建 `frontend/components/sentiment/` 目录

#### 任务2.3：实现情绪仪表盘组件
- [ ] 创建 `EmotionDashboard.tsx`
- [ ] 展示空间板高度（大数字）
- [ ] 展示晋级率（分层）
- [ ] 展示炸板率
- [ ] 展示情绪阶段（带颜色）

#### 任务2.4：实现昨日涨停表现组件
- [ ] 创建 `YesterdayPerformance.tsx`
- [ ] 展示涨跌分布条形图
- [ ] 展示大面统计
- [ ] 展示大面个股列表

#### 任务2.5：实现概念梯队组件
- [ ] 创建 `ConceptLadder.tsx`
- [ ] 冰点期提示
- [ ] 概念梯队树状展示
- [ ] 梯队完整度标识
- [ ] 独苗警告标识

#### 任务2.6：实现龙头分析组件
- [ ] 创建 `LeaderAnalysis.tsx`
- [ ] 龙头卡片布局
- [ ] 技术面展示（带评级）
- [ ] 资金面展示（带评级）
- [ ] 梯队情况展示
- [ ] 综合评估展示

#### 任务2.7：添加导航入口
- [ ] 在 Header 添加"情绪分析"导航
- [ ] 配置路由

---

### Phase 3：测试与优化

#### 任务3.1：功能测试
- [ ] 测试情绪仪表盘数据正确性
- [ ] 测试晋级率计算
- [ ] 测试昨日涨停表现（大面率）
- [ ] 测试概念梯队筛选逻辑
- [ ] 测试龙头分析综合评估

#### 任务3.2：边界情况测试
- [ ] 冰点期（空间板<4板）展示
- [ ] 无涨停数据时的展示
- [ ] 独苗龙头的警告展示

#### 任务3.3：UI优化
- [ ] 响应式布局调整
- [ ] 加载状态展示
- [ ] 错误状态展示

---

## 二、任务优先级

| 优先级 | 任务 | 说明 |
|-------|------|------|
| P0 | 情绪仪表盘 | 核心指标，必须先完成 |
| P0 | 龙头分析 | 核心功能，决策依据 |
| P1 | 昨日涨停表现 | 重要指标，大面率判断 |
| P1 | 概念梯队 | 辅助判断，梯队完整度 |
| P2 | UI优化 | 体验优化 |

---

## 三、技术依赖

### 3.1 后端依赖
- FastAPI（已有）
- Supabase Client（已有）
- trading_date 工具（已有，需确认 get_previous_trading_date 函数）

### 3.2 前端依赖
- React Query（已有）
- Tailwind CSS（已有）
- Card 组件（已有）

### 3.3 数据依赖
- `limit_stocks_detail` 表（已有）
- `market_sentiment` 表（已有）
- 昨日涨停股今日行情（需确认数据获取方式）

---

## 四、风险点

### 4.1 昨日涨停今日行情数据

**风险**：非涨停股今日涨跌幅无法从 limit_stocks_detail 获取

**应对**：
1. 短期：只统计昨日涨停股中今日仍涨停的情况
2. 中期：调用 Tushare 每日行情接口获取涨跌幅
3. 长期：新增每日行情表

### 4.2 概念归属不准确

**风险**：一只股票多个概念，主概念判断可能不准

**应对**：
1. 短期：取 concepts 数组第一个
2. 长期：优化为取涨停数最多的概念

---

## 五、验收检查清单

### 5.1 情绪仪表盘
- [ ] 空间板高度正确显示
- [ ] 晋级率分层计算正确
- [ ] 炸板率显示正确
- [ ] 情绪阶段判断合理

### 5.2 昨日涨停表现
- [ ] 昨日涨停数正确
- [ ] 大面数量统计正确（跌>5%）
- [ ] 大面率计算正确
- [ ] 大面个股列表正确排序

### 5.3 概念梯队分析
- [ ] 空间板<4板时显示提示
- [ ] 只展示有4板+股票的概念
- [ ] 梯队分布正确
- [ ] 独苗警告正确标识

### 5.4 龙头分析
- [ ] 显示所有4板+龙头
- [ ] 技术面评级正确
- [ ] 资金面评级正确
- [ ] 梯队情况正确
- [ ] 综合评估逻辑正确

---

## 六、后续迭代（v2.0）

- [ ] 接入 AI 分析（豆包生成龙头分析报告）
- [ ] 历史情绪周期回顾
- [ ] 情绪预警通知
- [ ] 龙头股次日表现追踪验证
- [ ] 完善昨日涨停今日行情数据获取
