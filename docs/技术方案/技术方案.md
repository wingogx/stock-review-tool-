# çŸ­çº¿å¤ç›˜å·¥å…· - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-07
**æŠ€æœ¯è´Ÿè´£äºº**: Win
**æ–‡æ¡£çŠ¶æ€**: âœ… å¯æ‰§è¡Œ

---

## ğŸ“‹ ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [æ•°æ®é‡‡é›†æ–¹æ¡ˆ](#3-æ•°æ®é‡‡é›†æ–¹æ¡ˆ)
4. [åç«¯ API æ–¹æ¡ˆ](#4-åç«¯-api-æ–¹æ¡ˆ)
5. [å‰ç«¯æ–¹æ¡ˆ](#5-å‰ç«¯æ–¹æ¡ˆ)
6. [æ•°æ®åº“æ–¹æ¡ˆ](#6-æ•°æ®åº“æ–¹æ¡ˆ)
7. [éƒ¨ç½²æ–¹æ¡ˆ](#7-éƒ¨ç½²æ–¹æ¡ˆ)
8. [å¼€å‘è§„èŒƒ](#8-å¼€å‘è§„èŒƒ)
9. [æµ‹è¯•æ–¹æ¡ˆ](#9-æµ‹è¯•æ–¹æ¡ˆ)
10. [è¿ç»´ç›‘æ§](#10-è¿ç»´ç›‘æ§)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|-----|------|------|---------|
| **å‰ç«¯æ¡†æ¶** | Next.js | 15.x | SSRæ”¯æŒã€å¼€å‘ä½“éªŒå¥½ã€VercelåŸç”Ÿæ”¯æŒ |
| **UIåº“** | Shadcn/ui | latest | åŸºäºRadix UIã€å¯å®šåˆ¶ã€TypeScriptæ”¯æŒ |
| **æ ·å¼** | Tailwind CSS | 3.x | å¿«é€Ÿå¼€å‘ã€æ ·å¼ä¸€è‡´æ€§ |
| **å›¾è¡¨** | Recharts | 2.x | ReactåŸç”Ÿã€è½»é‡çº§ |
| **çŠ¶æ€ç®¡ç†** | Zustand | 4.x | è½»é‡çº§ã€æ˜“ç”¨ |
| **åç«¯æ¡†æ¶** | FastAPI | 0.110+ | é«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ã€ç±»å‹å®‰å…¨ |
| **æ•°æ®é‡‡é›†** | Python 3.11+ | 3.11+ | ç”Ÿæ€ä¸°å¯Œã€ä¸é‡‡é›†åº“å…¼å®¹ |
| **ä»»åŠ¡è°ƒåº¦** | APScheduler | 3.10+ | å®šæ—¶ä»»åŠ¡ã€æŒä¹…åŒ– |
| **æ•°æ®åº“** | Supabase (PostgreSQL) | 15.x | å®æ—¶è®¢é˜…ã€Authã€å…è´¹é¢åº¦ |
| **ORM** | SQLAlchemy | 2.0+ | æˆç†Ÿç¨³å®šã€ç±»å‹æç¤º |
| **æ•°æ®æº** | Tushare Pro + AKShare | latest | æ•°æ®å®Œæ•´ã€æˆæœ¬æœ€ä¼˜ |

---

### 1.2 é¡¹ç›®ç»“æ„

```
çŸ­ä¿¡å¤ç›˜/
â”œâ”€â”€ frontend/                  # å‰ç«¯é¡¹ç›®ï¼ˆNext.jsï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/              # App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx      # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ api/          # API è·¯ç”±ï¼ˆä»£ç†ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ components/       # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MarketIndex.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MarketSentiment.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LimitStocks.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DragonTiger.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ HotConcepts.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Watchlist.tsx
â”‚   â”‚   â”œâ”€â”€ lib/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase.ts   # Supabase å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ types/            # TypeScript ç±»å‹
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ backend/                   # åç«¯é¡¹ç›®ï¼ˆFastAPIï¼‰
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py           # FastAPI å…¥å£
â”‚   â”‚   â”œâ”€â”€ routers/          # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ market.py
â”‚   â”‚   â”‚   â”œâ”€â”€ limit.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dragon_tiger.py
â”‚   â”‚   â”‚   â”œâ”€â”€ concepts.py
â”‚   â”‚   â”‚   â””â”€â”€ watchlist.py
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ data_collector.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tushare_service.py
â”‚   â”‚   â”‚   â””â”€â”€ akshare_service.py
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/          # Pydantic Schemas
â”‚   â”‚   â”œâ”€â”€ database.py       # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ scheduler.py      # å®šæ—¶ä»»åŠ¡
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.sql            # æ•°æ®åº“ Schema
â”‚   â””â”€â”€ migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ PRD.md
â”‚   â”œâ”€â”€ æŠ€æœ¯æ–¹æ¡ˆ.md
â”‚   â””â”€â”€ APIæ–‡æ¡£.md
â”‚
â””â”€â”€ scripts/                   # è„šæœ¬
    â”œâ”€â”€ data-collector-tushare-hybrid.py
    â””â”€â”€ test-tushare-token.py
```

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                          â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Next.js å‰ç«¯ (Vercel)              â”‚    â”‚
â”‚  â”‚                                            â”‚    â”‚
â”‚  â”‚  - SSR/SSG é¡µé¢æ¸²æŸ“                         â”‚    â”‚
â”‚  â”‚  - Shadcn/ui + Tailwind CSS              â”‚    â”‚
â”‚  â”‚  - Recharts æ•°æ®å¯è§†åŒ–                      â”‚    â”‚
â”‚  â”‚  - Supabase Client (å®æ—¶è®¢é˜…)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ HTTP/HTTPS + WebSocket
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚
    â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI åç«¯     â”‚    â”‚  Supabase        â”‚
â”‚  (Railway/Render)â”‚â†â”€â”€â”€â”‚  (PostgreSQL)    â”‚
â”‚                  â”‚    â”‚                  â”‚
â”‚  - RESTful API   â”‚    â”‚  - æ•°æ®å­˜å‚¨       â”‚
â”‚  - æ•°æ®èšåˆ       â”‚    â”‚  - å®æ—¶è®¢é˜…       â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘       â”‚    â”‚  - Row Security   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æ—¥16:00ï¼‰
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®é‡‡é›†æ¨¡å—                 â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  HybridDataCollector     â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚  - Tushare Collector     â”‚  â”‚
â”‚  â”‚  - AKShare Collector     â”‚  â”‚
â”‚  â”‚  - Data Processor        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tushare  â”‚    â”‚ AKShare  â”‚
â”‚  6000+   â”‚    â”‚   å…è´¹   â”‚
â”‚  ç§¯åˆ†    â”‚    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®šæ—¶è§¦å‘ï¼ˆæ¯æ—¥16:00ï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ•°æ®é‡‡é›†ï¼ˆHybridDataCollectorï¼‰                   â”‚
â”‚                                                     â”‚
â”‚  å¹¶è¡Œé‡‡é›†:                                           â”‚
â”‚  â”œâ”€ Tushare: é¾™è™æ¦œã€ä¸ªè‚¡è¡Œæƒ…ã€å¸‚åœºç»Ÿè®¡               â”‚
â”‚  â””â”€ AKShare: æ¶¨åœæ± ã€æ¦‚å¿µæ¿å—ã€å¸‚åœºæ´»è·ƒåº¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ•°æ®æ¸…æ´—å’Œè½¬æ¢                                    â”‚
â”‚                                                     â”‚
â”‚  - å­—æ®µæ˜ å°„å’Œç»Ÿä¸€                                     â”‚
â”‚  - æ•°æ®éªŒè¯å’Œå»é‡                                     â”‚
â”‚  - è®¡ç®—è¡ç”ŸæŒ‡æ ‡ï¼ˆæ¶¨è·Œæ¯”ã€ç‚¸æ¿ç‡ç­‰ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ•°æ®å­˜å‚¨ï¼ˆSupabaseï¼‰                             â”‚
â”‚                                                     â”‚
â”‚  - Upsert åˆ°å¯¹åº”æ•°æ®è¡¨                               â”‚
â”‚  - è§¦å‘å®æ—¶è®¢é˜…                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. API æŸ¥è¯¢ï¼ˆFastAPIï¼‰                              â”‚
â”‚                                                     â”‚
â”‚  - ä» Supabase æŸ¥è¯¢æ•°æ®                              â”‚
â”‚  - æ•°æ®èšåˆå’Œè®¡ç®—                                     â”‚
â”‚  - è¿”å› JSON å“åº”                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å‰ç«¯å±•ç¤ºï¼ˆNext.jsï¼‰                              â”‚
â”‚                                                     â”‚
â”‚  - SSR æ¸²æŸ“é¡µé¢                                      â”‚
â”‚  - å®¢æˆ·ç«¯å®æ—¶æ›´æ–°ï¼ˆSupabaseè®¢é˜…ï¼‰                     â”‚
â”‚  - å›¾è¡¨å¯è§†åŒ–                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®é‡‡é›†æ–¹æ¡ˆ

### 3.1 æ•°æ®é‡‡é›†æ¶æ„

**æ ¸å¿ƒç±»**: `HybridDataCollector`

**è®¾è®¡æ¨¡å¼**: ç­–ç•¥æ¨¡å¼ + æ¨¡æ¿æ–¹æ³•æ¨¡å¼

```python
# æ¶æ„è®¾è®¡
HybridDataCollector
    â”œâ”€â”€ TushareCollector      # Tushare æ•°æ®é‡‡é›†å™¨
    â”œâ”€â”€ AKShareCollector      # AKShare æ•°æ®é‡‡é›†å™¨
    â”œâ”€â”€ DataProcessor         # æ•°æ®å¤„ç†å™¨
    â””â”€â”€ DatabaseWriter        # æ•°æ®åº“å†™å…¥å™¨
```

---

### 3.2 æ•°æ®æºåˆ†å·¥

| æ•°æ®ç±»å‹ | ä½¿ç”¨æ•°æ®æº | API | é¢‘ç‡ |
|---------|-----------|-----|------|
| å¤§ç›˜æŒ‡æ•° | Tushare | `index_daily` | æ¯æ—¥1æ¬¡ |
| å¸‚åœºç»Ÿè®¡ | Tushare | `daily_info` | æ¯æ—¥1æ¬¡ |
| é¾™è™æ¦œæ˜ç»† | **Tushare** | `top_list` | æ¯æ—¥1æ¬¡ |
| æœºæ„å¸­ä½ | **Tushare** â­ | `top_inst` | æ¯æ—¥1æ¬¡ |
| ä¸ªè‚¡è¡Œæƒ… | Tushare | `daily` | æŒ‰éœ€ |
| æ¶¨åœæ±  | **AKShare** â­ | `stock_zt_pool_em` | æ¯æ—¥1æ¬¡ |
| ç‚¸æ¿æ•°æ® | **AKShare** â­ | `stock_zt_pool_zbgc_em` | æ¯æ—¥1æ¬¡ |
| æ¦‚å¿µæ¿å— | **AKShare** â­ | `stock_board_concept_name_ths` | æ¯æ—¥1æ¬¡ |
| å¸‚åœºæ´»è·ƒåº¦ | **AKShare** â­ | `stock_market_activity_legu` | æ¯æ—¥1æ¬¡ |

---

### 3.3 æ•°æ®é‡‡é›†æµç¨‹

#### 3.3.1 é‡‡é›†æ—¶æœº

```python
# ä½¿ç”¨ APScheduler Cron è¡¨è¾¾å¼
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger

scheduler = BackgroundScheduler(timezone='Asia/Shanghai')

# æ¯ä¸ªäº¤æ˜“æ—¥ 16:00 æ‰§è¡Œ
scheduler.add_job(
    func=collect_all_data,
    trigger=CronTrigger(
        day_of_week='mon-fri',  # å‘¨ä¸€åˆ°å‘¨äº”
        hour=16,                # 16ç‚¹
        minute=0,               # 0åˆ†
        timezone='Asia/Shanghai'
    ),
    id='daily_data_collection',
    name='æ¯æ—¥æ•°æ®é‡‡é›†',
    replace_existing=True
)
```

#### 3.3.2 é‡‡é›†é¡ºåº

```python
async def collect_all_data():
    """
    æ•°æ®é‡‡é›†ä¸»æµç¨‹
    æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ï¼Œç¡®ä¿ä¾èµ–å…³ç³»æ­£ç¡®
    """

    # 1. åŸºç¡€æ•°æ®ï¼ˆå¹¶è¡Œï¼‰
    tasks = [
        collect_market_index(),      # å¤§ç›˜æŒ‡æ•°
        collect_market_stats(),       # å¸‚åœºç»Ÿè®¡
    ]
    await asyncio.gather(*tasks)

    # 2. æ ¸å¿ƒæ•°æ®ï¼ˆå¹¶è¡Œï¼‰
    tasks = [
        collect_limit_stocks(),       # æ¶¨åœæ± ï¼ˆAKShareï¼‰
        collect_dragon_tiger(),       # é¾™è™æ¦œï¼ˆTushareï¼‰
        collect_concepts(),           # æ¦‚å¿µæ¿å—ï¼ˆAKShareï¼‰
    ]
    await asyncio.gather(*tasks)

    # 3. è¡ç”Ÿæ•°æ®ï¼ˆä¾èµ–å‰é¢çš„æ•°æ®ï¼‰
    await calculate_market_sentiment()  # å¸‚åœºæƒ…ç»ªï¼ˆåŸºäºæ¶¨åœæ± ç­‰æ•°æ®ï¼‰
    await analyze_institutional_seats() # æœºæ„å¸­ä½ç»Ÿè®¡ï¼ˆåŸºäºé¾™è™æ¦œï¼‰
    await calculate_concept_strength()  # æ¦‚å¿µå¼ºåº¦ï¼ˆåŸºäºæ¦‚å¿µæˆåˆ†è‚¡ï¼‰

    # 4. è‡ªé€‰è‚¡ç›‘æ§ï¼ˆå¦‚æœæœ‰è‡ªé€‰è‚¡ï¼‰
    await monitor_watchlist()
```

---

### 3.4 å…·ä½“å®ç°ä»£ç 

#### 3.4.1 Tushare æ•°æ®é‡‡é›†

```python
# backend/app/services/tushare_service.py

import tushare as ts
from datetime import datetime
from typing import Dict, Optional
import pandas as pd

class TushareCollector:
    """Tushare æ•°æ®é‡‡é›†å™¨"""

    def __init__(self, token: str):
        ts.set_token(token)
        self.pro = ts.pro_api()
        self.today = datetime.now().strftime("%Y%m%d")

    async def get_dragon_tiger_list(self) -> pd.DataFrame:
        """
        è·å–é¾™è™æ¦œæ¯æ—¥æ˜ç»†
        API: top_list
        ç§¯åˆ†è¦æ±‚: 2000
        """
        try:
            df = self.pro.top_list(
                trade_date=self.today,
                fields='trade_date,ts_code,name,close,pct_change,'
                       'amount,l_sell,l_buy,l_amount,net_amount,'
                       'net_rate,amount_rate,float_values,reason'
            )
            return df
        except Exception as e:
            logger.error(f"è·å–é¾™è™æ¦œå¤±è´¥: {e}")
            return pd.DataFrame()

    async def get_institutional_seats(self) -> pd.DataFrame:
        """
        è·å–é¾™è™æ¦œæœºæ„æ˜ç»†ï¼ˆ5000ç§¯åˆ†æ ¸å¿ƒä¼˜åŠ¿ï¼‰
        API: top_inst
        ç§¯åˆ†è¦æ±‚: 5000
        """
        try:
            df = self.pro.top_inst(
                trade_date=self.today,
                fields='trade_date,ts_code,exalter,buy,buy_rate,'
                       'sell,sell_rate,net_buy'
            )
            return df
        except Exception as e:
            logger.error(f"è·å–æœºæ„å¸­ä½å¤±è´¥: {e}")
            return pd.DataFrame()

    async def get_market_stats(self) -> pd.DataFrame:
        """
        è·å–å¸‚åœºäº¤æ˜“ç»Ÿè®¡
        API: daily_info
        ç§¯åˆ†è¦æ±‚: 2000
        """
        try:
            df = self.pro.daily_info(trade_date=self.today)
            return df
        except Exception as e:
            logger.error(f"è·å–å¸‚åœºç»Ÿè®¡å¤±è´¥: {e}")
            return pd.DataFrame()
```

---

#### 3.4.2 AKShare æ•°æ®é‡‡é›†

```python
# backend/app/services/akshare_service.py

import akshare as ak
from datetime import datetime
from typing import Dict, List
import pandas as pd

class AKShareCollector:
    """AKShare æ•°æ®é‡‡é›†å™¨"""

    def __init__(self):
        self.today = datetime.now().strftime("%Y%m%d")

    async def get_limit_stocks(self) -> Dict[str, pd.DataFrame]:
        """
        è·å–æ¶¨åœæ± æ•°æ®ï¼ˆAKShare ä¼˜åŠ¿ï¼šå­—æ®µè¯¦ç»†ï¼‰
        API: stock_zt_pool_em
        """
        try:
            # æ¶¨åœæ± 
            zt_df = ak.stock_zt_pool_em(date=self.today)

            # ç‚¸æ¿æ•°æ®
            zbgc_df = ak.stock_zt_pool_zbgc_em(date=self.today)

            return {
                "limit_up": zt_df,
                "exploded": zbgc_df
            }
        except Exception as e:
            logger.error(f"è·å–æ¶¨åœæ± å¤±è´¥: {e}")
            return {"limit_up": pd.DataFrame(), "exploded": pd.DataFrame()}

    async def get_hot_concepts(self) -> Dict[str, any]:
        """
        è·å–çƒ­é—¨æ¦‚å¿µæ¿å—ï¼ˆAKShare ä¼˜åŠ¿ï¼š374ä¸ªçƒ­é—¨é¢˜æï¼‰
        API: stock_board_concept_name_ths
        """
        try:
            # åŒèŠ±é¡ºæ¦‚å¿µæ¿å—
            concepts_df = ak.stock_board_concept_name_ths()

            # è·å– TOP 10 æ¦‚å¿µçš„æˆåˆ†è‚¡
            top_concepts = concepts_df.nlargest(10, 'æ¶¨è·Œå¹…')

            concept_details = []
            for _, concept in top_concepts.iterrows():
                concept_name = concept['æ¿å—åç§°']

                # è·å–æˆåˆ†è‚¡
                stocks_df = ak.stock_board_concept_cons_em(
                    symbol=concept_name
                )

                # é¾™å¤´è‚¡ TOP3
                top_stocks = stocks_df.nlargest(3, 'æ¶¨è·Œå¹…')

                # è®¡ç®—æ¦‚å¿µå¼ºåº¦
                up_count = len(stocks_df[stocks_df['æ¶¨è·Œå¹…'] > 0])
                avg_change = stocks_df['æ¶¨è·Œå¹…'].mean()
                strength = avg_change * up_count

                concept_details.append({
                    "concept": concept,
                    "stocks": stocks_df,
                    "top_stocks": top_stocks,
                    "strength": strength
                })

            return {
                "concepts": concepts_df,
                "details": concept_details
            }
        except Exception as e:
            logger.error(f"è·å–æ¦‚å¿µæ¿å—å¤±è´¥: {e}")
            return {"concepts": pd.DataFrame(), "details": []}

    async def get_market_activity(self) -> Dict[str, any]:
        """
        è·å–å¸‚åœºæ´»è·ƒåº¦ï¼ˆåŒèŠ±é¡ºç‹¬å®¶ï¼‰
        API: stock_market_activity_legu
        """
        try:
            df = ak.stock_market_activity_legu()
            activity_dict = dict(zip(df['item'], df['value']))

            return {
                "activity": float(
                    str(activity_dict.get('æ´»è·ƒåº¦', '0%')).replace('%', '')
                ),
                "suspended": int(activity_dict.get('åœç‰Œ', 0)),
                "up_count": int(activity_dict.get('ä¸Šæ¶¨', 0)),
                "down_count": int(activity_dict.get('ä¸‹è·Œ', 0))
            }
        except Exception as e:
            logger.error(f"è·å–å¸‚åœºæ´»è·ƒåº¦å¤±è´¥: {e}")
            return {}
```

---

#### 3.4.3 æ··åˆæ•°æ®é‡‡é›†å™¨

```python
# backend/app/services/data_collector.py

from .tushare_service import TushareCollector
from .akshare_service import AKShareCollector
from ..database import get_supabase_client
import logging

logger = logging.getLogger(__name__)

class HybridDataCollector:
    """æ··åˆæ•°æ®é‡‡é›†å™¨ - æ•´åˆ Tushare å’Œ AKShare"""

    def __init__(self, tushare_token: str):
        self.tushare = TushareCollector(tushare_token)
        self.akshare = AKShareCollector()
        self.supabase = get_supabase_client()
        self.today = datetime.now().strftime("%Y-%m-%d")

    async def collect_all(self):
        """æ‰§è¡Œå®Œæ•´çš„æ•°æ®é‡‡é›†æµç¨‹"""
        logger.info(f"å¼€å§‹æ•°æ®é‡‡é›†: {self.today}")

        try:
            # 1. é¾™è™æ¦œï¼ˆTushare - æœºæ„å¸­ä½è‡ªåŠ¨åˆ†ç±»ï¼‰
            await self._collect_dragon_tiger()

            # 2. æ¶¨åœæ± ï¼ˆAKShare - å­—æ®µè¯¦ç»†ï¼‰
            await self._collect_limit_stocks()

            # 3. æ¦‚å¿µæ¿å—ï¼ˆAKShare - 374ä¸ªçƒ­é—¨é¢˜æï¼‰
            await self._collect_concepts()

            # 4. å¸‚åœºæƒ…ç»ªï¼ˆç»¼åˆæ•°æ®ï¼‰
            await self._calculate_market_sentiment()

            logger.info("âœ… æ•°æ®é‡‡é›†å®Œæˆ")

        except Exception as e:
            logger.error(f"âŒ æ•°æ®é‡‡é›†å¤±è´¥: {e}")
            raise

    async def _collect_dragon_tiger(self):
        """é‡‡é›†é¾™è™æ¦œæ•°æ®"""
        # 1. é¾™è™æ¦œæ˜ç»†
        lhb_df = await self.tushare.get_dragon_tiger_list()

        if not lhb_df.empty:
            # å†™å…¥ dragon_tiger_board è¡¨
            records = lhb_df.to_dict('records')
            for record in records:
                self.supabase.table('dragon_tiger_board').upsert({
                    'trade_date': self.today,
                    'stock_code': record['ts_code'],
                    'stock_name': record['name'],
                    'close_price': float(record['close']),
                    'change_pct': float(record['pct_change']),
                    'total_buy': float(record['l_buy']),
                    'total_sell': float(record['l_sell']),
                    'net_amount': float(record['net_amount']),
                    'reason': record['reason']
                }).execute()

        # 2. æœºæ„å¸­ä½ï¼ˆ5000ç§¯åˆ†ä¼˜åŠ¿ï¼‰
        inst_df = await self.tushare.get_institutional_seats()

        if not inst_df.empty:
            # å†™å…¥ institutional_seats è¡¨
            records = inst_df.to_dict('records')
            for record in records:
                self.supabase.table('institutional_seats').upsert({
                    'trade_date': self.today,
                    'stock_code': record['ts_code'],
                    'exalter': record['exalter'],
                    'buy_amount': float(record['buy']),
                    'sell_amount': float(record['sell']),
                    'net_buy': float(record['net_buy'])
                }).execute()

    async def _collect_limit_stocks(self):
        """é‡‡é›†æ¶¨åœæ± æ•°æ®"""
        limit_data = await self.akshare.get_limit_stocks()

        zt_df = limit_data.get('limit_up')

        if not zt_df.empty:
            records = zt_df.to_dict('records')
            for record in records:
                self.supabase.table('limit_stocks_detail').upsert({
                    'trade_date': self.today,
                    'stock_code': record['ä»£ç '],
                    'stock_name': record['åç§°'],
                    'limit_type': 'limit_up',
                    'close_price': float(record['æœ€æ–°ä»·']),
                    'change_pct': float(record['æ¶¨è·Œå¹…']),
                    'turnover': float(record['æˆäº¤é¢']),
                    'turnover_rate': float(record['æ¢æ‰‹ç‡']),
                    'first_limit_time': record.get('é¦–æ¬¡å°æ¿æ—¶é—´'),
                    'last_limit_time': record.get('æœ€åå°æ¿æ—¶é—´'),
                    'continuous_days': int(record.get('è¿æ¿æ•°', 1)),
                    'opening_times': int(record.get('å¼€æ¿æ¬¡æ•°', 0)),
                    'industry': record.get('æ‰€å±è¡Œä¸š', '')
                }).execute()

    async def _collect_concepts(self):
        """é‡‡é›†æ¦‚å¿µæ¿å—æ•°æ®"""
        concept_data = await self.akshare.get_hot_concepts()

        details = concept_data.get('details', [])

        for item in details:
            concept = item['concept']
            stocks_df = item['stocks']
            top_stocks = item['top_stocks']
            strength = item['strength']

            # ä¿å­˜æ¦‚å¿µæ•°æ®
            self.supabase.table('hot_concepts').upsert({
                'trade_date': self.today,
                'concept_name': concept['æ¿å—åç§°'],
                'change_pct': float(concept['æ¶¨è·Œå¹…']),
                'avg_change': float(stocks_df['æ¶¨è·Œå¹…'].mean()),
                'up_count': len(stocks_df[stocks_df['æ¶¨è·Œå¹…'] > 0]),
                'down_count': len(stocks_df[stocks_df['æ¶¨è·Œå¹…'] < 0]),
                'leading_stocks': top_stocks['åç§°'].tolist()[:3],
                'strength_score': float(strength),
                'total_stocks': len(stocks_df)
            }).execute()

    async def _calculate_market_sentiment(self):
        """è®¡ç®—å¸‚åœºæƒ…ç»ª"""
        # ä»å·²é‡‡é›†çš„æ•°æ®ä¸­ç»Ÿè®¡

        # æ¶¨åœæ•°
        limit_up = self.supabase.table('limit_stocks_detail')\
            .select('*')\
            .eq('trade_date', self.today)\
            .eq('limit_type', 'limit_up')\
            .execute()

        limit_up_count = len(limit_up.data)

        # è¿æ¿åˆ†å¸ƒ
        continuous_dist = {}
        for stock in limit_up.data:
            days = stock['continuous_days']
            continuous_dist[str(days)] = continuous_dist.get(str(days), 0) + 1

        # ç‚¸æ¿ç‡
        exploded_count = len([s for s in limit_up.data if s['opening_times'] > 0])
        explosion_rate = (exploded_count / limit_up_count * 100) if limit_up_count > 0 else 0

        # å¸‚åœºæ´»è·ƒåº¦ï¼ˆAKShareï¼‰
        activity = await self.akshare.get_market_activity()

        # ä¿å­˜å¸‚åœºæƒ…ç»ª
        self.supabase.table('market_sentiment').upsert({
            'trade_date': self.today,
            'limit_up_count': limit_up_count,
            'continuous_limit_distribution': continuous_dist,
            'exploded_count': exploded_count,
            'explosion_rate': explosion_rate,
            'market_activity': activity.get('activity', 0),
            'up_count': activity.get('up_count', 0),
            'down_count': activity.get('down_count', 0)
        }).execute()
```

---

### 3.5 é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

```python
# backend/app/services/retry_handler.py

from tenacity import retry, stop_after_attempt, wait_exponential
import logging

logger = logging.getLogger(__name__)

@retry(
    stop=stop_after_attempt(3),        # æœ€å¤šé‡è¯•3æ¬¡
    wait=wait_exponential(min=1, max=10),  # æŒ‡æ•°é€€é¿
    reraise=True
)
async def fetch_with_retry(func, *args, **kwargs):
    """å¸¦é‡è¯•æœºåˆ¶çš„æ•°æ®è·å–"""
    try:
        return await func(*args, **kwargs)
    except Exception as e:
        logger.warning(f"è¯·æ±‚å¤±è´¥ï¼Œå‡†å¤‡é‡è¯•: {e}")
        raise

# ä½¿ç”¨ç¤ºä¾‹
df = await fetch_with_retry(
    self.tushare.get_dragon_tiger_list
)
```

---

### 3.6 æ•°æ®éªŒè¯

```python
# backend/app/services/data_validator.py

from pydantic import BaseModel, validator
from typing import Optional
from datetime import date

class LimitStockData(BaseModel):
    """æ¶¨åœè‚¡ç¥¨æ•°æ®éªŒè¯"""
    stock_code: str
    stock_name: str
    close_price: float
    change_pct: float
    continuous_days: int

    @validator('change_pct')
    def validate_change_pct(cls, v):
        if v < 9.5:  # æ¶¨åœè‡³å°‘9.5%
            raise ValueError('æ¶¨è·Œå¹…ä¸ç¬¦åˆæ¶¨åœæ ‡å‡†')
        return v

    @validator('continuous_days')
    def validate_continuous_days(cls, v):
        if v < 1:
            raise ValueError('è¿æ¿å¤©æ•°ä¸èƒ½å°äº1')
        return v

# ä½¿ç”¨
try:
    validated_data = LimitStockData(**record)
except ValidationError as e:
    logger.error(f"æ•°æ®éªŒè¯å¤±è´¥: {e}")
```

---

## 4. åç«¯ API æ–¹æ¡ˆ

### 4.1 API æ¶æ„è®¾è®¡

**æ¡†æ¶**: FastAPI
**API é£æ ¼**: RESTful
**è®¤è¯æ–¹å¼**: Supabase JWTï¼ˆå¯é€‰ï¼ŒMVP é˜¶æ®µå¯è·³è¿‡ï¼‰

---

### 4.2 API è·¯ç”±è®¾è®¡

```python
# backend/app/main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from .routers import market, limit, dragon_tiger, concepts, watchlist

app = FastAPI(
    title="çŸ­çº¿å¤ç›˜ API",
    description="è‚¡ç¥¨çŸ­çº¿å¤ç›˜æ•°æ®API",
    version="1.0.0"
)

# CORS é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶ä¸ºå‰ç«¯åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(market.router, prefix="/api/market", tags=["å¸‚åœºæ•°æ®"])
app.include_router(limit.router, prefix="/api/limit", tags=["æ¶¨åœæ± "])
app.include_router(dragon_tiger.router, prefix="/api/dragon-tiger", tags=["é¾™è™æ¦œ"])
app.include_router(concepts.router, prefix="/api/concepts", tags=["æ¦‚å¿µæ¿å—"])
app.include_router(watchlist.router, prefix="/api/watchlist", tags=["è‡ªé€‰è‚¡"])

@app.get("/")
async def root():
    return {
        "message": "çŸ­çº¿å¤ç›˜ API",
        "version": "1.0.0",
        "docs": "/docs"
    }

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

---

### 4.3 å…·ä½“ API å®ç°

#### 4.3.1 å¸‚åœºæ•°æ® API

```python
# backend/app/routers/market.py

from fastapi import APIRouter, HTTPException, Query
from typing import Optional
from datetime import date, datetime
from ..database import get_supabase_client
from ..schemas import MarketIndexResponse, MarketSentimentResponse

router = APIRouter()

@router.get("/index", response_model=list[MarketIndexResponse])
async def get_market_index(
    trade_date: Optional[str] = Query(
        None,
        description="äº¤æ˜“æ—¥æœŸ YYYY-MM-DDï¼Œé»˜è®¤ä¸ºæœ€æ–°äº¤æ˜“æ—¥"
    )
):
    """
    è·å–å¤§ç›˜æŒ‡æ•°æ•°æ®

    è¿”å›ä¸Šè¯ã€æ·±è¯ã€åˆ›ä¸šæ¿ä¸‰å¤§æŒ‡æ•°çš„è¡Œæƒ…æ•°æ®
    """
    supabase = get_supabase_client()

    # å¦‚æœæ²¡æœ‰æŒ‡å®šæ—¥æœŸï¼Œè·å–æœ€æ–°æ—¥æœŸ
    if not trade_date:
        result = supabase.table('market_index')\
            .select('trade_date')\
            .order('trade_date', desc=True)\
            .limit(1)\
            .execute()

        if result.data:
            trade_date = result.data[0]['trade_date']
        else:
            raise HTTPException(status_code=404, detail="æš‚æ— æ•°æ®")

    # æŸ¥è¯¢æŒ‡å®šæ—¥æœŸçš„æŒ‡æ•°æ•°æ®
    result = supabase.table('market_index')\
        .select('*')\
        .eq('trade_date', trade_date)\
        .execute()

    if not result.data:
        raise HTTPException(
            status_code=404,
            detail=f"æœªæ‰¾åˆ° {trade_date} çš„æ•°æ®"
        )

    return result.data


@router.get("/sentiment", response_model=MarketSentimentResponse)
async def get_market_sentiment(
    trade_date: Optional[str] = Query(None)
):
    """
    è·å–å¸‚åœºæƒ…ç»ªæ•°æ®

    åŒ…å«æ¶¨è·Œæ¯”ã€æ¶¨åœæ•°ã€è¿æ¿åˆ†å¸ƒã€ç‚¸æ¿ç‡ã€å¸‚åœºæ´»è·ƒåº¦ç­‰
    """
    supabase = get_supabase_client()

    if not trade_date:
        # è·å–æœ€æ–°æ—¥æœŸ
        result = supabase.table('market_sentiment')\
            .select('trade_date')\
            .order('trade_date', desc=True)\
            .limit(1)\
            .execute()

        if result.data:
            trade_date = result.data[0]['trade_date']

    result = supabase.table('market_sentiment')\
        .select('*')\
        .eq('trade_date', trade_date)\
        .single()\
        .execute()

    if not result.data:
        raise HTTPException(status_code=404, detail="æš‚æ— æ•°æ®")

    return result.data
```

---

#### 4.3.2 æ¶¨åœæ±  API

```python
# backend/app/routers/limit.py

from fastapi import APIRouter, Query
from typing import Optional, Literal
from ..database import get_supabase_client
from ..schemas import LimitStockResponse

router = APIRouter()

@router.get("/stocks", response_model=list[LimitStockResponse])
async def get_limit_stocks(
    trade_date: Optional[str] = Query(None),
    limit_type: Literal['limit_up', 'limit_down'] = Query(
        'limit_up',
        description="æ¶¨åœæˆ–è·Œåœ"
    ),
    min_continuous_days: Optional[int] = Query(
        None,
        description="æœ€å°è¿æ¿å¤©æ•°"
    ),
    filter_st: bool = Query(
        True,
        description="æ˜¯å¦è¿‡æ»¤STè‚¡ç¥¨"
    ),
    order_by: Literal['continuous_days', 'first_limit_time', 'turnover'] = Query(
        'continuous_days',
        description="æ’åºå­—æ®µ"
    )
):
    """
    è·å–æ¶¨åœ/è·Œåœè‚¡ç¥¨åˆ—è¡¨

    æ”¯æŒç­›é€‰å’Œæ’åºåŠŸèƒ½
    """
    supabase = get_supabase_client()

    # æ„å»ºæŸ¥è¯¢
    query = supabase.table('limit_stocks_detail')\
        .select('*')\
        .eq('limit_type', limit_type)

    if trade_date:
        query = query.eq('trade_date', trade_date)

    if min_continuous_days:
        query = query.gte('continuous_days', min_continuous_days)

    if filter_st:
        query = query.not_.like('stock_name', '%ST%')\
                     .not_.like('stock_name', '%*%')

    # æ’åº
    query = query.order(order_by, desc=True)

    result = query.execute()

    return result.data


@router.get("/stats", response_model=dict)
async def get_limit_stats(trade_date: Optional[str] = None):
    """
    è·å–æ¶¨åœç»Ÿè®¡æ•°æ®

    è¿”å›è¿æ¿åˆ†å¸ƒã€ç‚¸æ¿ç»Ÿè®¡ç­‰
    """
    supabase = get_supabase_client()

    # æŸ¥è¯¢æ¶¨åœæ•°æ®
    query = supabase.table('limit_stocks_detail')\
        .select('continuous_days, opening_times')\
        .eq('limit_type', 'limit_up')

    if trade_date:
        query = query.eq('trade_date', trade_date)

    result = query.execute()
    data = result.data

    # ç»Ÿè®¡è¿æ¿åˆ†å¸ƒ
    continuous_dist = {}
    exploded_count = 0

    for stock in data:
        days = stock['continuous_days']
        continuous_dist[str(days)] = continuous_dist.get(str(days), 0) + 1

        if stock['opening_times'] > 0:
            exploded_count += 1

    return {
        "total_limit_up": len(data),
        "continuous_distribution": continuous_dist,
        "exploded_count": exploded_count,
        "explosion_rate": (exploded_count / len(data) * 100) if data else 0
    }
```

---

#### 4.3.3 é¾™è™æ¦œ API

```python
# backend/app/routers/dragon_tiger.py

from fastapi import APIRouter, Query
from typing import Optional
from ..database import get_supabase_client

router = APIRouter()

@router.get("/list")
async def get_dragon_tiger_list(
    trade_date: Optional[str] = Query(None),
    order_by: str = Query('net_amount', description="æ’åºå­—æ®µ")
):
    """
    è·å–é¾™è™æ¦œåˆ—è¡¨

    è¿”å›å½“æ—¥ä¸Šæ¦œè‚¡ç¥¨
    """
    supabase = get_supabase_client()

    query = supabase.table('dragon_tiger_board').select('*')

    if trade_date:
        query = query.eq('trade_date', trade_date)

    query = query.order(order_by, desc=True)

    result = query.execute()
    return result.data


@router.get("/seats/{stock_code}")
async def get_stock_seats(
    stock_code: str,
    trade_date: Optional[str] = Query(None)
):
    """
    è·å–ä¸ªè‚¡å¸­ä½æ˜ç»†

    è¿”å›ä¹°å…¥å‰5å’Œå–å‡ºå‰5çš„å¸­ä½ä¿¡æ¯
    """
    supabase = get_supabase_client()

    query = supabase.table('dragon_tiger_seats')\
        .select('*')\
        .eq('stock_code', stock_code)

    if trade_date:
        query = query.eq('trade_date', trade_date)

    result = query.execute()

    # åˆ†ç¦»ä¹°å…¥å’Œå–å‡ºå¸­ä½
    buy_seats = [s for s in result.data if s['rank_type'] == 'buy']
    sell_seats = [s for s in result.data if s['rank_type'] == 'sell']

    return {
        "stock_code": stock_code,
        "buy_seats": sorted(buy_seats, key=lambda x: x['rank']),
        "sell_seats": sorted(sell_seats, key=lambda x: x['rank'])
    }


@router.get("/institutional")
async def get_institutional_summary(
    trade_date: Optional[str] = Query(None)
):
    """
    è·å–æœºæ„å¸­ä½ç»Ÿè®¡

    è¿”å›æœºæ„ä¹°å…¥/å–å‡ºæ±‡æ€»
    """
    supabase = get_supabase_client()

    query = supabase.table('institutional_seats').select('*')

    if trade_date:
        query = query.eq('trade_date', trade_date)

    result = query.execute()
    data = result.data

    # ç»Ÿè®¡
    total_buy = sum(s['buy_amount'] for s in data)
    total_sell = sum(s['sell_amount'] for s in data)
    net_buy = sum(s['net_buy'] for s in data)

    # æœºæ„ä¹°å…¥ TOP5
    top_buy = sorted(data, key=lambda x: x['buy_amount'], reverse=True)[:5]

    return {
        "total_buy": total_buy,
        "total_sell": total_sell,
        "net_buy": net_buy,
        "institutional_count": len(data),
        "top_buy_stocks": top_buy
    }
```

---

#### 4.3.4 æ¦‚å¿µæ¿å— API

```python
# backend/app/routers/concepts.py

from fastapi import APIRouter, Query
from typing import Optional
from ..database import get_supabase_client

router = APIRouter()

@router.get("/hot")
async def get_hot_concepts(
    trade_date: Optional[str] = Query(None),
    top_n: int = Query(10, description="è¿”å›å‰Nä¸ªæ¦‚å¿µ"),
    order_by: str = Query('change_pct', description="æ’åºå­—æ®µ")
):
    """
    è·å–çƒ­é—¨æ¦‚å¿µæ¿å—

    é»˜è®¤è¿”å›æ¶¨å¹…å‰10çš„æ¦‚å¿µ
    """
    supabase = get_supabase_client()

    query = supabase.table('hot_concepts').select('*')

    if trade_date:
        query = query.eq('trade_date', trade_date)

    query = query.order(order_by, desc=True).limit(top_n)

    result = query.execute()
    return result.data


@router.get("/stocks/{concept_name}")
async def get_concept_stocks(
    concept_name: str,
    trade_date: Optional[str] = Query(None)
):
    """
    è·å–æ¦‚å¿µæˆåˆ†è‚¡

    è¿”å›æŒ‡å®šæ¦‚å¿µçš„æ‰€æœ‰æˆåˆ†è‚¡
    """
    supabase = get_supabase_client()

    query = supabase.table('concept_stocks')\
        .select('*')\
        .eq('concept_name', concept_name)

    if trade_date:
        query = query.eq('trade_date', trade_date)

    query = query.order('change_pct', desc=True)

    result = query.execute()

    return {
        "concept_name": concept_name,
        "total_stocks": len(result.data),
        "stocks": result.data
    }
```

---

### 4.4 Pydantic Schemas

```python
# backend/app/schemas.py

from pydantic import BaseModel
from typing import Optional, List, Dict
from datetime import date, time
from decimal import Decimal

class MarketIndexResponse(BaseModel):
    """å¤§ç›˜æŒ‡æ•°å“åº”"""
    trade_date: date
    index_code: str
    index_name: str
    open_price: Optional[Decimal]
    close_price: Optional[Decimal]
    high_price: Optional[Decimal]
    low_price: Optional[Decimal]
    change_pct: Optional[Decimal]
    amplitude: Optional[Decimal]
    turnover: Optional[Decimal]

    class Config:
        from_attributes = True


class MarketSentimentResponse(BaseModel):
    """å¸‚åœºæƒ…ç»ªå“åº”"""
    trade_date: date
    total_amount: Optional[Decimal]
    up_count: Optional[int]
    down_count: Optional[int]
    up_down_ratio: Optional[Decimal]
    limit_up_count: Optional[int]
    limit_down_count: Optional[int]
    continuous_limit_distribution: Optional[Dict[str, int]]
    exploded_count: Optional[int]
    explosion_rate: Optional[Decimal]
    market_activity: Optional[Decimal]


class LimitStockResponse(BaseModel):
    """æ¶¨åœè‚¡ç¥¨å“åº”"""
    trade_date: date
    stock_code: str
    stock_name: str
    limit_type: str
    close_price: Decimal
    change_pct: Decimal
    turnover: Optional[Decimal]
    turnover_rate: Optional[Decimal]
    first_limit_time: Optional[time]
    last_limit_time: Optional[time]
    continuous_days: int
    opening_times: int
    industry: Optional[str]
    concepts: Optional[List[str]]
```

---

## 5. å‰ç«¯æ–¹æ¡ˆ

### 5.1 æŠ€æœ¯é€‰å‹

- **æ¡†æ¶**: Next.js 15 (App Router)
- **è¯­è¨€**: TypeScript
- **UIåº“**: Shadcn/ui + Radix UI
- **æ ·å¼**: Tailwind CSS
- **å›¾è¡¨**: Recharts
- **çŠ¶æ€ç®¡ç†**: Zustand
- **HTTPå®¢æˆ·ç«¯**: Fetch API / Axios
- **å®æ—¶è®¢é˜…**: Supabase Realtime

---

### 5.2 é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx                    # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ layout.tsx                  # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ api/                        # API è·¯ç”±ï¼ˆä»£ç†åç«¯ï¼‰
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                         # Shadcn UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ MarketIndex.tsx             # å¤§ç›˜æŒ‡æ•°ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ MarketSentiment.tsx         # å¸‚åœºæƒ…ç»ªç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LimitStocksList.tsx         # æ¶¨åœæ± åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ DragonTigerBoard.tsx        # é¾™è™æ¦œç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HotConcepts.tsx             # çƒ­é—¨æ¦‚å¿µç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ WatchlistMonitor.tsx        # è‡ªé€‰è‚¡ç›‘æ§
â”‚   â”‚   â””â”€â”€ Layout/
â”‚   â”‚       â”œâ”€â”€ Header.tsx
â”‚   â”‚       â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚       â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts                 # Supabase å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ api.ts                      # API è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ utils.ts                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ constants.ts                # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useMarketData.ts            # å¸‚åœºæ•°æ® Hook
â”‚   â”‚   â”œâ”€â”€ useLimitStocks.ts           # æ¶¨åœæ•°æ® Hook
â”‚   â”‚   â””â”€â”€ useRealtime.ts              # å®æ—¶è®¢é˜… Hook
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts                    # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ store/
â”‚       â””â”€â”€ useStore.ts                 # Zustand Store
â”œâ”€â”€ public/
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

### 5.3 æ ¸å¿ƒç»„ä»¶å®ç°

#### 5.3.1 é¦–é¡µå¸ƒå±€

```tsx
// src/app/page.tsx

import MarketIndex from '@/components/MarketIndex'
import MarketSentiment from '@/components/MarketSentiment'
import LimitStocksList from '@/components/LimitStocksList'
import DragonTigerBoard from '@/components/DragonTigerBoard'
import HotConcepts from '@/components/HotConcepts'
import WatchlistMonitor from '@/components/WatchlistMonitor'

export default function HomePage() {
  return (
    <div className="container mx-auto p-4 space-y-6">
      {/* é¡¶éƒ¨ï¼šå¤§ç›˜æŒ‡æ•° */}
      <section>
        <h2 className="text-2xl font-bold mb-4">å¤§ç›˜æŒ‡æ•°</h2>
        <MarketIndex />
      </section>

      {/* å¸‚åœºæƒ…ç»ª */}
      <section>
        <h2 className="text-2xl font-bold mb-4">å¸‚åœºæƒ…ç»ª</h2>
        <MarketSentiment />
      </section>

      {/* ä¸¤æ å¸ƒå±€ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* å·¦ä¾§ï¼šæ¶¨åœæ±  */}
        <section>
          <h2 className="text-2xl font-bold mb-4">æ¶¨åœæ± </h2>
          <LimitStocksList />
        </section>

        {/* å³ä¾§ï¼šé¾™è™æ¦œ */}
        <section>
          <h2 className="text-2xl font-bold mb-4">é¾™è™æ¦œ</h2>
          <DragonTigerBoard />
        </section>
      </div>

      {/* çƒ­é—¨æ¦‚å¿µ */}
      <section>
        <h2 className="text-2xl font-bold mb-4">çƒ­é—¨æ¦‚å¿µ</h2>
        <HotConcepts />
      </section>

      {/* è‡ªé€‰è‚¡ç›‘æ§ */}
      <section>
        <h2 className="text-2xl font-bold mb-4">è‡ªé€‰è‚¡ç›‘æ§</h2>
        <WatchlistMonitor />
      </section>
    </div>
  )
}
```

---

#### 5.3.2 å¤§ç›˜æŒ‡æ•°ç»„ä»¶

```tsx
// src/components/MarketIndex.tsx

'use client'

import { useEffect, useState } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { fetchMarketIndex } from '@/lib/api'
import { MarketIndex as MarketIndexType } from '@/types'

export default function MarketIndex() {
  const [indices, setIndices] = useState<MarketIndexType[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    loadData()
  }, [])

  const loadData = async () => {
    try {
      const data = await fetchMarketIndex()
      setIndices(data)
    } catch (error) {
      console.error('åŠ è½½å¤§ç›˜æŒ‡æ•°å¤±è´¥:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return <div>åŠ è½½ä¸­...</div>
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {indices.map((index) => (
        <Card key={index.index_code}>
          <CardHeader>
            <CardTitle>{index.index_name}</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2">
              <div className="flex justify-between items-center">
                <span className="text-3xl font-bold">
                  {index.close_price?.toFixed(2)}
                </span>
                <span
                  className={`text-lg font-semibold ${
                    (index.change_pct ?? 0) >= 0
                      ? 'text-red-600'
                      : 'text-green-600'
                  }`}
                >
                  {(index.change_pct ?? 0) >= 0 ? '+' : ''}
                  {index.change_pct?.toFixed(2)}%
                </span>
              </div>
              <div className="text-sm text-gray-600 space-y-1">
                <div className="flex justify-between">
                  <span>å¼€:</span>
                  <span>{index.open_price?.toFixed(2)}</span>
                </div>
                <div className="flex justify-between">
                  <span>é«˜:</span>
                  <span>{index.high_price?.toFixed(2)}</span>
                </div>
                <div className="flex justify-between">
                  <span>ä½:</span>
                  <span>{index.low_price?.toFixed(2)}</span>
                </div>
                <div className="flex justify-between">
                  <span>æŒ¯å¹…:</span>
                  <span>{index.amplitude?.toFixed(2)}%</span>
                </div>
                <div className="flex justify-between">
                  <span>æˆäº¤é¢:</span>
                  <span>{(Number(index.turnover) / 100000000).toFixed(0)}äº¿</span>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  )
}
```

---

#### 5.3.3 æ¶¨åœæ± åˆ—è¡¨ç»„ä»¶

```tsx
// src/components/LimitStocksList.tsx

'use client'

import { useEffect, useState } from 'react'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Badge } from '@/components/ui/badge'
import { fetchLimitStocks } from '@/lib/api'
import { LimitStock } from '@/types'

export default function LimitStocksList() {
  const [stocks, setStocks] = useState<LimitStock[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    loadData()
  }, [])

  const loadData = async () => {
    try {
      const data = await fetchLimitStocks()
      setStocks(data)
    } catch (error) {
      console.error('åŠ è½½æ¶¨åœæ± å¤±è´¥:', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="rounded-md border">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>ä»£ç </TableHead>
            <TableHead>åç§°</TableHead>
            <TableHead>æ¶¨å¹…</TableHead>
            <TableHead>ä»·æ ¼</TableHead>
            <TableHead>æˆäº¤é¢</TableHead>
            <TableHead>å°æ¿æ—¶é—´</TableHead>
            <TableHead>è¿æ¿</TableHead>
            <TableHead>å¼€æ¿</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {stocks.map((stock) => (
            <TableRow key={stock.stock_code}>
              <TableCell className="font-mono">{stock.stock_code}</TableCell>
              <TableCell className="font-semibold">{stock.stock_name}</TableCell>
              <TableCell className="text-red-600 font-semibold">
                +{stock.change_pct.toFixed(2)}%
              </TableCell>
              <TableCell>{stock.close_price.toFixed(2)}</TableCell>
              <TableCell>
                {(Number(stock.turnover) / 100000000).toFixed(2)}äº¿
              </TableCell>
              <TableCell className="text-sm">
                {stock.first_limit_time || '-'}
              </TableCell>
              <TableCell>
                {stock.continuous_days > 1 && (
                  <Badge variant="destructive">
                    {stock.continuous_days}è¿æ¿
                  </Badge>
                )}
              </TableCell>
              <TableCell>
                {stock.opening_times > 0 && (
                  <Badge variant="outline">{stock.opening_times}æ¬¡</Badge>
                )}
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  )
}
```

---

#### 5.3.4 API å°è£…

```typescript
// src/lib/api.ts

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'

export async function fetchMarketIndex() {
  const response = await fetch(`${API_BASE_URL}/api/market/index`)

  if (!response.ok) {
    throw new Error('Failed to fetch market index')
  }

  return response.json()
}

export async function fetchMarketSentiment() {
  const response = await fetch(`${API_BASE_URL}/api/market/sentiment`)

  if (!response.ok) {
    throw new Error('Failed to fetch market sentiment')
  }

  return response.json()
}

export async function fetchLimitStocks(params?: {
  minContinuousDays?: number
  orderBy?: string
}) {
  const queryString = new URLSearchParams(params as any).toString()
  const url = `${API_BASE_URL}/api/limit/stocks${queryString ? `?${queryString}` : ''}`

  const response = await fetch(url)

  if (!response.ok) {
    throw new Error('Failed to fetch limit stocks')
  }

  return response.json()
}

export async function fetchDragonTigerList() {
  const response = await fetch(`${API_BASE_URL}/api/dragon-tiger/list`)

  if (!response.ok) {
    throw new Error('Failed to fetch dragon tiger list')
  }

  return response.json()
}

export async function fetchHotConcepts(topN: number = 10) {
  const response = await fetch(
    `${API_BASE_URL}/api/concepts/hot?top_n=${topN}`
  )

  if (!response.ok) {
    throw new Error('Failed to fetch hot concepts')
  }

  return response.json()
}
```

---

### 5.4 å®æ—¶æ•°æ®è®¢é˜…

```typescript
// src/hooks/useRealtime.ts

'use client'

import { useEffect } from 'react'
import { createClient } from '@/lib/supabase'

export function useRealtimeMarketData(onUpdate: (data: any) => void) {
  useEffect(() => {
    const supabase = createClient()

    // è®¢é˜…å¸‚åœºæƒ…ç»ªè¡¨çš„å˜åŒ–
    const channel = supabase
      .channel('market_sentiment_changes')
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'market_sentiment'
        },
        (payload) => {
          console.log('å¸‚åœºæ•°æ®æ›´æ–°:', payload)
          onUpdate(payload.new)
        }
      )
      .subscribe()

    return () => {
      supabase.removeChannel(channel)
    }
  }, [onUpdate])
}
```

---

## 6. æ•°æ®åº“æ–¹æ¡ˆ

### 6.1 Supabase é…ç½®

#### 6.1.1 åˆ›å»ºé¡¹ç›®

1. è®¿é—® https://supabase.com
2. åˆ›å»ºæ–°é¡¹ç›®
3. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   - Project URL
   - API Key (anon public)
   - Database Password

#### 6.1.2 æ‰§è¡Œ Schema

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

```sql
-- å‚è€ƒ database-schema-enhanced.sql
-- åˆ›å»º11å¼ è¡¨ï¼ˆæ­¤å¤„çœç•¥ï¼Œä½¿ç”¨ä¹‹å‰å·²åˆ›å»ºçš„ schemaï¼‰
```

#### 6.1.3 é…ç½® Row Level Security (å¯é€‰)

```sql
-- å…è®¸åŒ¿åè¯»å–
ALTER TABLE market_index ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow anonymous read access"
ON market_index FOR SELECT
TO anon
USING (true);

-- å¯¹æ‰€æœ‰è¡¨é‡å¤æ­¤æ“ä½œ
```

---

### 6.2 æ•°æ®åº“è¿æ¥é…ç½®

```python
# backend/app/database.py

from supabase import create_client, Client
import os
from functools import lru_cache

@lru_cache()
def get_supabase_client() -> Client:
    """è·å– Supabase å®¢æˆ·ç«¯ï¼ˆå•ä¾‹ï¼‰"""
    url = os.getenv("SUPABASE_URL")
    key = os.getenv("SUPABASE_KEY")

    if not url or not key:
        raise ValueError("SUPABASE_URL å’Œ SUPABASE_KEY å¿…é¡»è®¾ç½®")

    return create_client(url, key)
```

---

## 7. éƒ¨ç½²æ–¹æ¡ˆ

### 7.1 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel (å‰ç«¯)      â”‚  â† Next.js åº”ç”¨
â”‚   çŸ­ä¿¡å¤ç›˜.vercel.appâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ API è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Railway (åç«¯)      â”‚  â† FastAPI åº”ç”¨
â”‚  api.çŸ­ä¿¡å¤ç›˜.com    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ æ•°æ®å­˜å‚¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase (æ•°æ®åº“)   â”‚  â† PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7.2 å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

#### æ­¥éª¤ï¼š

1. **è¿æ¥ GitHub ä»“åº“**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-repo-url>
   git push -u origin main
   ```

2. **åœ¨ Vercel å¯¼å…¥é¡¹ç›®**
   - è®¿é—® https://vercel.com
   - ç‚¹å‡» "Import Project"
   - é€‰æ‹© GitHub ä»“åº“

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```
   NEXT_PUBLIC_API_URL=https://your-backend-url.railway.app
   NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

4. **éƒ¨ç½²**
   - Vercel è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²
   - æ¯æ¬¡ push åˆ° main åˆ†æ”¯è‡ªåŠ¨é‡æ–°éƒ¨ç½²

---

### 7.3 åç«¯éƒ¨ç½²ï¼ˆRailwayï¼‰

#### æ­¥éª¤ï¼š

1. **åˆ›å»º Railway é¡¹ç›®**
   - è®¿é—® https://railway.app
   - è¿æ¥ GitHub ä»“åº“

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```
   TUSHARE_TOKEN=2876ea85cb005fb5fa17c809a98174f2d5aae8b1f830110a5ead6211
   SUPABASE_URL=your-supabase-url
   SUPABASE_KEY=your-service-key
   PORT=8000
   ```

3. **é…ç½® `railway.json`**
   ```json
   {
     "$schema": "https://railway.app/railway.schema.json",
     "build": {
       "builder": "NIXPACKS"
     },
     "deploy": {
       "startCommand": "uvicorn app.main:app --host 0.0.0.0 --port $PORT",
       "restartPolicyType": "ON_FAILURE",
       "restartPolicyMaxRetries": 10
     }
   }
   ```

4. **é…ç½® `Procfile`**
   ```
   web: uvicorn app.main:app --host 0.0.0.0 --port $PORT
   worker: python -m app.scheduler
   ```

---

### 7.4 å®šæ—¶ä»»åŠ¡éƒ¨ç½²

**é€‰é¡¹ 1: ä½¿ç”¨ APSchedulerï¼ˆæ¨èï¼‰**

```python
# backend/app/scheduler.py

from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
from .services.data_collector import HybridDataCollector
import os

def start_scheduler():
    """å¯åŠ¨è°ƒåº¦å™¨"""
    scheduler = BackgroundScheduler(timezone='Asia/Shanghai')

    collector = HybridDataCollector(
        tushare_token=os.getenv("TUSHARE_TOKEN")
    )

    scheduler.add_job(
        func=collector.collect_all,
        trigger=CronTrigger(
            day_of_week='mon-fri',
            hour=16,
            minute=0
        ),
        id='daily_collection',
        replace_existing=True
    )

    scheduler.start()
    logger.info("âœ… è°ƒåº¦å™¨å·²å¯åŠ¨")

# åœ¨ main.py ä¸­è°ƒç”¨
from .scheduler import start_scheduler

@app.on_event("startup")
async def startup_event():
    start_scheduler()
```

**é€‰é¡¹ 2: ä½¿ç”¨ GitHub Actions**

```yaml
# .github/workflows/daily-collection.yml

name: Daily Data Collection

on:
  schedule:
    - cron: '0 8 * * 1-5'  # UTC 08:00 = åŒ—äº¬æ—¶é—´ 16:00

jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: pip install -r backend/requirements.txt
      - run: python backend/scripts/collect_data.py
        env:
          TUSHARE_TOKEN: ${{ secrets.TUSHARE_TOKEN }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
```

---

## 8. å¼€å‘è§„èŒƒ

### 8.1 Git å·¥ä½œæµ

```bash
# åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/limit-stocks-list
git commit -m "feat: æ·»åŠ æ¶¨åœæ± åˆ—è¡¨ç»„ä»¶"
git push origin feature/limit-stocks-list

# æäº¤ä¿¡æ¯è§„èŒƒ
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·
```

---

### 8.2 ä»£ç è§„èŒƒ

**Python (Black + Flake8)**

```bash
# å®‰è£…
pip install black flake8

# æ ¼å¼åŒ–
black backend/

# æ£€æŸ¥
flake8 backend/
```

**TypeScript (ESLint + Prettier)**

```bash
# å®‰è£…
npm install --save-dev eslint prettier

# æ ¼å¼åŒ–
npm run format

# æ£€æŸ¥
npm run lint
```

---

## 9. æµ‹è¯•æ–¹æ¡ˆ

### 9.1 åç«¯æµ‹è¯•

```python
# tests/test_data_collector.py

import pytest
from app.services.data_collector import HybridDataCollector

@pytest.fixture
def collector():
    return HybridDataCollector(token="test_token")

def test_collect_limit_stocks(collector):
    """æµ‹è¯•æ¶¨åœæ± é‡‡é›†"""
    result = await collector._collect_limit_stocks()

    assert result is not None
    assert len(result) > 0

def test_collect_dragon_tiger(collector):
    """æµ‹è¯•é¾™è™æ¦œé‡‡é›†"""
    result = await collector._collect_dragon_tiger()

    assert result is not None
```

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
pytest backend/tests/ -v
```

---

### 9.2 å‰ç«¯æµ‹è¯•

```tsx
// __tests__/MarketIndex.test.tsx

import { render, screen } from '@testing-library/react'
import MarketIndex from '@/components/MarketIndex'

describe('MarketIndex', () => {
  it('renders market indices', () => {
    render(<MarketIndex />)

    expect(screen.getByText('ä¸Šè¯æŒ‡æ•°')).toBeInTheDocument()
    expect(screen.getByText('æ·±è¯æˆæŒ‡')).toBeInTheDocument()
    expect(screen.getByText('åˆ›ä¸šæ¿æŒ‡')).toBeInTheDocument()
  })
})
```

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
npm test
```

---

## 10. è¿ç»´ç›‘æ§

### 10.1 æ—¥å¿—è®°å½•

```python
# backend/app/logger.py

import logging
from logging.handlers import RotatingFileHandler

def setup_logger():
    logger = logging.getLogger('stock_review')
    logger.setLevel(logging.INFO)

    # æ–‡ä»¶å¤„ç†å™¨
    file_handler = RotatingFileHandler(
        'logs/app.log',
        maxBytes=10485760,  # 10MB
        backupCount=5
    )

    # æ ¼å¼
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    file_handler.setFormatter(formatter)

    logger.addHandler(file_handler)

    return logger
```

---

### 10.2 é”™è¯¯ç›‘æ§

**ä½¿ç”¨ Sentryï¼š**

```python
# backend/app/main.py

import sentry_sdk

sentry_sdk.init(
    dsn="your-sentry-dsn",
    traces_sample_rate=1.0,
)

@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    sentry_sdk.capture_exception(exc)
    return JSONResponse(
        status_code=500,
        content={"detail": "Internal server error"}
    )
```

---

### 10.3 æ€§èƒ½ç›‘æ§

**Railway å†…ç½®ç›‘æ§ï¼š**
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- è¯·æ±‚å“åº”æ—¶é—´

**è‡ªå®šä¹‰ç›‘æ§ï¼š**

```python
from prometheus_client import Counter, Histogram

# è¯·æ±‚è®¡æ•°
request_count = Counter('app_requests_total', 'Total requests')

# å“åº”æ—¶é—´
response_time = Histogram('app_response_time_seconds', 'Response time')

@app.middleware("http")
async def monitor_requests(request, call_next):
    request_count.inc()

    with response_time.time():
        response = await call_next(request)

    return response
```

---

## ğŸ“ é™„å½•

### A. ç¯å¢ƒå˜é‡æ¸…å•

**åç«¯ (.env)**

```bash
# Tushare
TUSHARE_TOKEN=2876ea85cb005fb5fa17c809a98174f2d5aae8b1f830110a5ead6211

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=your-service-role-key

# æœåŠ¡å™¨
PORT=8000
ENV=production

# æ—¥å¿—
LOG_LEVEL=INFO
```

**å‰ç«¯ (.env.local)**

```bash
NEXT_PUBLIC_API_URL=https://your-backend.railway.app
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

---

### B. ä¾èµ–æ¸…å•

**åç«¯ (requirements.txt)**

```
fastapi==0.110.0
uvicorn[standard]==0.27.0
tushare==1.3.8
akshare==1.13.0
supabase==2.3.0
pandas==2.2.0
python-dotenv==1.0.0
APScheduler==3.10.4
pydantic==2.6.0
tenacity==8.2.3
```

**å‰ç«¯ (package.json)**

```json
{
  "dependencies": {
    "next": "15.0.0",
    "react": "18.3.0",
    "react-dom": "18.3.0",
    "@supabase/supabase-js": "^2.39.0",
    "recharts": "^2.10.0",
    "zustand": "^4.5.0",
    "tailwindcss": "^3.4.0"
  },
  "devDependencies": {
    "typescript": "^5.3.0",
    "@types/react": "^18.2.0",
    "eslint": "^8.56.0",
    "prettier": "^3.2.0"
  }
}
```

---

### C. å¿«é€Ÿå¼€å§‹å‘½ä»¤

**åç«¯å¯åŠ¨ï¼š**

```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```

**å‰ç«¯å¯åŠ¨ï¼š**

```bash
cd frontend
npm install
npm run dev
```

**æ•°æ®é‡‡é›†æµ‹è¯•ï¼š**

```bash
cd backend
python -m app.scripts.test_collection
```

---

**æ–‡æ¡£ç»“æŸ**

å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [PRD.md](./PRD.md) - äº§å“éœ€æ±‚æ–‡æ¡£
- [æ•°æ®æºå¯¹æ¯”åˆ†æ.md](./æ•°æ®æºå¯¹æ¯”åˆ†æ.md) - æ•°æ®æºé€‰å‹
- [database-schema-enhanced.sql](./database-schema-enhanced.sql) - æ•°æ®åº“è®¾è®¡
