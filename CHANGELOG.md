# 更新日志 (Changelog)

## [1.2.0] - 2025-12-09

### 🔄 重要变更

#### 炸板率计算逻辑优化 - 采用行业通用口径

**背景**：
原有炸板率计算方式与行业通用口径存在差异，导致数据与主流平台（如东方财富、东强吧等）对比时出现较大偏差。

**原计算逻辑**：
```
炸板率 = (涨停股池中炸板次数 > 0 的股票数) / 涨停股总数 × 100%
基数 = 收盘时涨停的股票（53只）
结果 = 47.17%（封板率 52.83%）
```

**新计算逻辑（通用口径）**：
```
炸板率 = 炸板股数 / (涨停股数 + 炸板股数) × 100%
基数 = 所有触及涨停板的股票（涨停53只 + 炸板23只 = 76只）
结果 = 30.26%（封板率 69.74%）
```

**数据对比验证**：
- 我们的炸板率：30.26%
- 东强吧破板率：30.3%
- 差异：0.04个百分点 ✅

### ✨ 新增功能

#### 1. 新增炸板股池数据采集

**API**：`stock_zt_pool_zbgc_em` - 东方财富炸板股池

**方法**：`MarketSentimentCollector.collect_exploded_pool()`

**功能**：采集盘中触及涨停但最终未封住的股票数据

**位置**：`backend/app/services/collectors/market_sentiment_collector.py:159-184`

### 🔧 代码修改

#### 1. 市场情绪采集器 (MarketSentimentCollector)

**文件**：`backend/app/services/collectors/market_sentiment_collector.py`

**修改内容**：

1. **新增方法**：
   - `collect_exploded_pool()` - 采集炸板股池数据（第159-184行）

2. **修改方法**：
   - `calculate_explosion_rate()` - 改用通用口径计算炸板率（第243-273行）
     - 参数变更：`(limit_up_df)` → `(limit_up_count, exploded_df)`
     - 逻辑变更：统计独立炸板股池，而非涨停股池中的炸板股

3. **更新采集流程**：
   - 第5步：新增采集炸板股池（第304-305行）
   - 第9步：使用新方法计算炸板率（第322-323行）

### 📊 数据字段说明

**market_sentiment 表字段**（无变更）：
- `exploded_count` - 炸板股数量
- `explosion_rate` - 炸板率（计算逻辑变更）
- `limit_up_count` - 涨停股数量

**计算公式**：
```python
exploded_count = len(exploded_df)  # 炸板股数
total_touched = limit_up_count + exploded_count  # 总触及涨停数
explosion_rate = (exploded_count / total_touched * 100)  # 炸板率
sealing_rate = 100 - explosion_rate  # 封板率
```

### 🎯 影响范围

- ✅ 后端数据采集逻辑
- ✅ 炸板率计算结果
- ⚠️ 前端显示的炸板率/封板率数值会发生变化
- ⚠️ 历史数据对比时需注意口径差异

### 📝 注意事项

1. **历史数据说明**：
   - 2025-12-09 之前的数据使用旧口径计算
   - 2025-12-09 及之后的数据使用新口径计算
   - 对比历史数据时需考虑口径差异

2. **数据源说明**：
   - 涨停股池：`stock_zt_pool_em` (东方财富)
   - 炸板股池：`stock_zt_pool_zbgc_em` (东方财富)
   - 两个数据源均来自东方财富，保证数据一致性

3. **API调用频率**：
   - 新增1个API调用（炸板股池）
   - 建议在采集时适当延迟，避免触发频率限制

---

## [1.1.0] - 2025-12-08

### ✨ 新增功能

- 完成数据采集模块开发（大盘指数、涨停股池、市场情绪、热门概念）
- 实现自动化数据采集定时任务
- 添加数据完整性检查和自动补全机制

### 🐛 Bug修复

- 修复大盘指数API接口稳定性问题
- 解决市场情绪数据成交额环比计算错误
- 修复前端显示字段映射问题

---

## [1.0.0] - 2025-12-07

### 🎉 初始版本

- 项目初始化
- 数据库schema设计
- 基础架构搭建
